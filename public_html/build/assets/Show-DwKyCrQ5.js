import{r as n,u as T,P as L,j as e,H as F,b as w,a as O}from"./app-BfpvEa9J.js";import{A as d}from"./AuthenticatedLayout-BAkMyy8i.js";import{C as I}from"./circle-alert-DZaQ4RVN.js";import{c as o}from"./createLucideIcon-TZ2qlloe.js";import{C as V}from"./cpu-shkRyWml.js";import{F as H}from"./file-text-CMNpT4Rm.js";import{C as U}from"./circle-check-big-5d_0cvAU.js";import{M as y}from"./message-square-8RDTV3k5.js";import{S as B}from"./send-dYZK34hi.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],G=o("activity",K);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],v=o("clock",J);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],W=o("copy",Q);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Y=o("external-link",X);function oe({ordenId:x}){var f,j,N,k;const[s,_]=n.useState(null),[C,p]=n.useState(!0),[m,u]=n.useState(null),[i,h]=n.useState([]),b=n.useRef(null),{data:c,setData:g,processing:E,reset:S}=T({mensaje_texto:"",requiere_aprobacion:!1}),z=()=>{var t;(t=b.current)==null||t.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{z()},[i]);const A=()=>{w.get(`/api/ventas/ordenes/${x}`).then(t=>{t.data.error?u(t.data.error):_(t.data),p(!1)}).catch(t=>{var r,a;console.error("Error al cargar orden:",t),u(((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.error)||"Error de conexión al cargar la orden."),p(!1)})};n.useEffect(()=>{A()},[x]),n.useEffect(()=>{if(!(s!=null&&s.tracking_token))return;const t=new L("cbd8be0eaf6853d5161c",{cluster:"mt1",forceTLS:!0,enabledTransports:["ws","wss"]});return t.subscribe(`chat.${s.tracking_token}`).bind("nuevo-mensaje",function(a){const D=a.mensaje||a;h(R=>[...R,D])}),()=>{t.unsubscribe(`chat.${s.tracking_token}`),t.disconnect()}},[s==null?void 0:s.tracking_token]);const M=()=>{confirm("¿Desea generar la factura fiscal?")&&O.post(route("facturas.convertir",s.id))},q=async t=>{if(t.preventDefault(),!c.mensaje_texto)return;const r={texto:c.mensaje_texto,emisor:"staff",created_at:new Date().toISOString(),requiere_aprobacion:c.requiere_aprobacion};h(a=>[...a,r]);try{await w.post("/api/ventas/enviar-chat",{mensaje:r,token:s.tracking_token}),S("mensaje_texto","requiere_aprobacion")}catch(a){console.error("Falla al enviar mensaje:",a)}},$=()=>{if(!(s!=null&&s.tracking_token)){alert("No hay token de seguimiento generado para esta orden.");return}const t=`${window.location.origin}/tracking/${s.tracking_token}`;navigator.clipboard.writeText(t),alert("Enlace de seguimiento copiado")},P=t=>t==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t);if(C)return e.jsx(d,{children:e.jsxs("div",{className:"max-w-6xl mx-auto p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4 font-bold uppercase tracking-widest",children:"Cargando datos de la orden..."})]})});if(m)return e.jsx(d,{children:e.jsx("div",{className:"max-w-3xl mx-auto p-12 mt-10",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-8 rounded-2xl shadow-sm flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(I,{size:48,className:"text-red-500"}),e.jsxs("div",{children:[e.jsx("strong",{className:"font-black text-xl block mb-2 uppercase tracking-tighter",children:"Error del Servidor"}),e.jsx("span",{className:"text-base font-bold text-red-600 bg-white px-4 py-2 rounded-lg border border-red-100 shadow-inner block",children:m})]})]})})});if(!s)return null;const l=((f=s.produccion)==null?void 0:f[0])||null;return e.jsxs(d,{children:[e.jsx(F,{title:`Orden ${s.numero_orden}`}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6 mt-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-2 shadow-sm border border-slate-200 flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-xl",children:[e.jsx(G,{size:18,className:"text-blue-600"}),e.jsx("span",{className:"text-xs font-black uppercase text-slate-700",children:"Estado Real:"}),e.jsx("span",{className:`text-xs font-black px-2 py-1 rounded-lg ${(l==null?void 0:l.estado)==="Terminado"?"bg-green-500 text-white":"bg-blue-500 text-white animate-pulse"}`,children:l?l.estado:"En Pre-Prensa"})]}),(l==null?void 0:l.maquina)&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-l border-slate-200",children:[e.jsx(V,{size:18,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-tighter",children:"Máquina actual:"}),e.jsx("span",{className:"text-xs font-black text-slate-800",children:l.maquina.nombre})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 bg-slate-50 border-b border-slate-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-slate-900 tracking-tighter italic",children:["#",s.numero_orden]}),e.jsx("p",{className:"text-sm font-bold text-slate-500 uppercase",children:(j=s.cliente)==null?void 0:j.razon_social})]}),e.jsxs("div",{className:"flex gap-2",children:[s.estado==="Confirmada"&&e.jsxs("button",{onClick:M,className:"px-4 py-2 bg-green-600 text-white rounded-xl font-black text-xs hover:bg-green-700 flex items-center gap-2 shadow-lg transition-all",children:[e.jsx(H,{size:16})," FACTURAR"]}),e.jsxs("span",{className:`px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 ${s.estado_diseno==="Aprobado"?"bg-green-100 text-green-700 border border-green-200":"bg-yellow-100 text-yellow-700 border border-yellow-200"}`,children:[s.estado_diseno==="Aprobado"?e.jsx(U,{size:14}):e.jsx(v,{size:14}),"Diseño: ",s.estado_diseno]})]})]}),e.jsx("div",{className:"p-6 overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-4 text-left text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Descripción"}),e.jsx("th",{className:"pb-4 text-center text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Cant."}),e.jsx("th",{className:"pb-4 text-right text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Total"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-50",children:[(N=s.detalles)==null?void 0:N.map(t=>{var r,a;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsxs("td",{className:"py-4",children:[e.jsx("div",{className:"font-bold text-slate-800 text-sm",children:((r=t.item)==null?void 0:r.nombre)||"Producto sin nombre"}),e.jsxs("div",{className:"text-[9px] text-slate-400 font-black uppercase tracking-tighter",children:["SKU: ",((a=t.item)==null?void 0:a.codigo)||"N/A"]})]}),e.jsx("td",{className:"py-4 text-center font-black text-slate-600",children:t.cantidad}),e.jsx("td",{className:"py-4 text-right font-black text-slate-900",children:P(t.total)})]},t.id)}),!((k=s.detalles)!=null&&k.length)&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"py-8 text-center text-slate-400 text-sm font-bold uppercase",children:"No hay productos en esta orden"})})]})]})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-blue-900 rounded-2xl p-6 text-white flex justify-between items-center shadow-2xl",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-black text-lg flex items-center gap-2 uppercase tracking-tighter",children:[e.jsx(Y,{size:20,className:"text-blue-400"})," Portal del Cliente"]}),e.jsx("p",{className:"text-slate-400 text-[10px] font-bold uppercase tracking-widest",children:"Canal Pusher Realtime • Seguimiento Externo"})]}),e.jsxs("button",{onClick:$,className:"bg-white text-blue-900 px-6 py-3 rounded-xl font-black text-xs hover:bg-blue-50 flex items-center gap-2 transition-all active:scale-95 shadow-lg",children:[e.jsx(W,{size:16})," COPIAR LINK"]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col h-[700px] sticky top-6",children:[e.jsxs("div",{className:"p-4 border-b bg-slate-900 text-white rounded-t-2xl flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-xs uppercase tracking-widest flex items-center gap-2",children:[e.jsx(y,{size:18,className:"text-blue-400"})," Chat Externo"]}),e.jsxs("span",{className:"flex items-center gap-1.5 px-2 py-1 bg-green-500/10 rounded-full",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[9px] font-black text-green-400",children:"EN VIVO"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50",children:[i.length===0&&e.jsxs("div",{className:"text-center py-20 opacity-20 grayscale",children:[e.jsx(y,{size:40,className:"mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest",children:"Esperando interacción..."})]}),i.map((t,r)=>e.jsx("div",{className:`flex ${t.emisor==="staff"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] p-4 rounded-2xl shadow-sm ${t.emisor==="staff"?"bg-blue-600 text-white rounded-tr-none":"bg-white text-slate-800 border border-slate-200 rounded-tl-none"}`,children:[e.jsx("p",{className:"text-xs font-bold leading-relaxed",children:t.texto}),t.requiere_aprobacion&&e.jsxs("div",{className:"mt-3 py-1.5 px-3 bg-yellow-400 text-yellow-950 text-[9px] font-black rounded-lg uppercase flex items-center gap-2 shadow-inner",children:[e.jsx(v,{size:12})," PENDIENTE DE APROBACIÓN"]}),e.jsx("div",{className:"text-[8px] mt-2 opacity-60 text-right font-black italic",children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},r)),e.jsx("div",{ref:b})]}),e.jsxs("form",{onSubmit:q,className:"p-4 border-t bg-white rounded-b-2xl space-y-3",children:[e.jsx("textarea",{value:c.mensaje_texto,onChange:t=>g("mensaje_texto",t.target.value),placeholder:"Mensaje instantáneo vía Pusher...",className:"w-full border-none rounded-xl text-xs font-bold focus:ring-0 h-24 bg-slate-100 p-3 shadow-inner placeholder:text-slate-400"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 text-[10px] font-black text-slate-500 cursor-pointer hover:text-blue-600 transition-colors uppercase tracking-tighter",children:[e.jsx("input",{type:"checkbox",checked:c.requiere_aprobacion,onChange:t=>g("requiere_aprobacion",t.target.checked),className:"rounded text-blue-600 border-slate-300 focus:ring-blue-600"}),"Pedir Aprobación"]}),e.jsxs("button",{type:"submit",disabled:!c.mensaje_texto||E,className:"bg-blue-600 text-white px-6 py-2.5 rounded-xl font-black text-xs flex items-center gap-2 disabled:opacity-30 hover:bg-blue-700 transition-all hover:scale-105 active:scale-95 shadow-lg shadow-blue-100",children:[e.jsx(B,{size:14})," ENVIAR"]})]})]})]})})]})]})]})}export{oe as default};
