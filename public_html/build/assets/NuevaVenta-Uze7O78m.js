import{r as d,j as e,H as S,b as y}from"./app-BqyPfEI0.js";import{A as k}from"./AuthenticatedLayout-ChjIDkpR.js";import{u,d as x}from"./db-B-TONdRf.js";import{S as L}from"./SyncService-CQ-RfCnd.js";function E({auth:N,cliente_id:o}){const[i,v]=d.useState(""),[r,g]=d.useState([]),[m,h]=d.useState(!1),b=u(()=>x.clientes.get(parseInt(o)),[o]),l=u(()=>x.catalogo.toArray()),c=u(()=>x.inventario.toArray()),f=d.useMemo(()=>l?l.filter(a=>a.nombre.toLowerCase().includes(i.toLowerCase())||a.codigo.toLowerCase().includes(i.toLowerCase())):[],[l,i]),w=a=>{g(s=>s.find(t=>t.id===a.id)?s.map(t=>t.id===a.id?{...t,cantidad:t.cantidad+1}:t):[...s,{...a,cantidad:1}])},p=(a,s)=>{g(n=>n.map(t=>{if(t.id===a){const A=Math.max(0,t.cantidad+s);return{...t,cantidad:A}}return t}).filter(t=>t.cantidad>0))},j=d.useMemo(()=>r.reduce((a,s)=>a+s.precio*s.cantidad,0),[r]),C=async()=>{if(r.length!==0){h(!0);try{await L.crearOrdenOffline(parseInt(o),r.map(a=>({id:a.id,cantidad:a.cantidad,precio:a.precio})),j,"preventa"),alert("‚úÖ Pedido guardado localmente. Se sincronizar√° cuando haya conexi√≥n."),y.visit("/pwa/ruta-entrega")}catch(a){console.error(a),alert("‚ùå Error al guardar pedido")}finally{h(!1)}}};return b?e.jsxs(k,{user:N.user,header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>y.visit("/pwa/ruta-entrega"),className:"text-sm bg-gray-200 px-2 py-1 rounded",children:"‚¨Ö Volver"}),e.jsxs("h2",{className:"font-semibold text-lg text-gray-800 leading-tight truncate ml-2",children:["Venta: ",b.nombre_fiscal]})]}),children:[e.jsx(S,{title:"Nueva Venta"}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)]",children:[e.jsx("div",{className:"p-4 bg-white shadow z-10",children:e.jsx("input",{type:"text",placeholder:"üîç Buscar producto...",className:"w-full border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500",value:i,onChange:a=>v(a.target.value)})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 bg-gray-50 pb-24",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[f.map(a=>{const s=r.find(t=>t.id===a.id),n=c==null?void 0:c.find(t=>t.item_id===a.id);return e.jsxs("div",{className:"bg-white p-3 rounded shadow flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-gray-800",children:a.nombre}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Cod: ",a.codigo]}),e.jsxs("div",{className:"text-blue-600 font-bold",children:["$",parseFloat(a.precio).toFixed(2)]}),n&&e.jsxs("div",{className:"text-xs text-green-600",children:["Stock Cami√≥n: ",n.cantidad]})]}),s?e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 p-1 rounded",children:[e.jsx("button",{onClick:()=>p(a.id,-1),className:"w-8 h-8 bg-blue-200 rounded text-blue-800 font-bold",children:"-"}),e.jsx("span",{className:"font-bold w-6 text-center",children:s.cantidad}),e.jsx("button",{onClick:()=>p(a.id,1),className:"w-8 h-8 bg-blue-600 rounded text-white font-bold",children:"+"})]}):e.jsx("button",{onClick:()=>w(a),className:"bg-gray-100 hover:bg-gray-200 text-gray-800 px-4 py-2 rounded border border-gray-300",children:"Agregar"})]},a.id)}),f.length===0&&e.jsx("div",{className:"text-center text-gray-500 mt-10",children:"No se encontraron productos."})]})}),r.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 shadow-lg p-4 z-20",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"text-gray-600",children:[r.length," √çtems"]}),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["$",j.toFixed(2)]})]}),e.jsx("button",{onClick:C,disabled:m,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-md transition disabled:opacity-50",children:m?"Guardando...":"FINALIZAR PEDIDO"})]})})]})]}):e.jsx("div",{className:"p-4 text-center",children:"Cargando cliente..."})}export{E as default};
