import{r,P as N,j as e,H as v,b as k,a as y}from"./app-BfpvEa9J.js";import{P as E}from"./package-DgPQUhNa.js";import{C as S}from"./circle-alert-DZaQ4RVN.js";import{C as _}from"./circle-check-big-5d_0cvAU.js";import{M as b}from"./message-square-8RDTV3k5.js";import{S as A}from"./send-dYZK34hi.js";import"./createLucideIcon-TZ2qlloe.js";function O({orden:t}){var h;const[n,c]=r.useState([]),[i,o]=r.useState(""),[d,x]=r.useState(!1),p=r.useRef(null),f=()=>{var s;(s=p.current)==null||s.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{f()},[n]),r.useEffect(()=>{if(!(t!=null&&t.tracking_token))return;const s=new N("cbd8be0eaf6853d5161c",{cluster:"mt1",forceTLS:!0,enabledTransports:["ws","wss"]});return s.subscribe(`chat.${t.tracking_token}`).bind("nuevo-mensaje",function(l){const j=l.mensaje||l;c(w=>[...w,j])}),()=>{s.unsubscribe(`chat.${t.tracking_token}`),s.disconnect()}},[t==null?void 0:t.tracking_token]);const m=async s=>{if(s.preventDefault(),!i)return;x(!0);const a={texto:i,emisor:"cliente",created_at:new Date().toISOString(),requiere_aprobacion:!1};c(l=>[...l,a]);try{await k.post("/api/ventas/enviar-chat",{mensaje:a,token:t.tracking_token}),o("")}catch(l){console.error("Falla al enviar mensaje a Pusher:",l)}finally{x(!1)}},g=()=>{confirm("쮼st치s seguro de que deseas APROBAR este dise침o? Una vez aprobado, tu orden pasar치 a producci칩n y no se podr치n hacer cambios.")&&y.post(`/tracking/${t.tracking_token}/approve`,{},{preserveScroll:!0})},u=s=>s==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return t?e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans text-slate-800 selection:bg-blue-200",children:[e.jsx(v,{title:`Seguimiento Orden #${t.numero_orden}`}),e.jsxs("div",{className:"bg-white border-b border-slate-200 px-6 py-4 flex justify-between items-center shadow-sm",children:[e.jsxs("div",{className:"font-black text-xl text-blue-900 tracking-tighter flex items-center gap-2",children:[e.jsx(E,{size:24,className:"text-blue-600"}),"PORTAL DEL CLIENTE"]}),e.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"SpacioArte"})]}),e.jsxs("div",{className:"max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 space-y-6",children:[t.estado_diseno==="Pendiente"&&e.jsxs("div",{className:"bg-yellow-400 text-yellow-950 rounded-2xl p-6 shadow-lg shadow-yellow-400/20 flex flex-col sm:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(S,{size:32,className:"text-yellow-700 shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg uppercase tracking-tighter",children:"춰Atenci칩n Requerida!"}),e.jsx("p",{className:"text-sm font-medium mt-1 opacity-90 max-w-xl",children:"Hemos enviado el dise침o de tu pedido por el chat. Por favor rev칤salo y, si est치s de acuerdo, haz clic en Aprobar para que tu orden ingrese a producci칩n de inmediato."})]})]}),e.jsx("button",{onClick:g,className:"bg-yellow-950 text-yellow-400 px-8 py-4 rounded-xl font-black text-sm uppercase tracking-widest hover:bg-black hover:scale-105 transition-all shadow-xl whitespace-nowrap active:scale-95",children:"Aprobar Dise침o"})]}),t.estado_diseno==="Aprobado"&&e.jsxs("div",{className:"bg-green-500 text-white rounded-2xl p-4 shadow-lg shadow-green-500/20 flex items-center justify-center gap-3",children:[e.jsx(_,{size:24}),e.jsx("span",{className:"font-black text-sm uppercase tracking-widest",children:"Dise침o Aprobado - En Producci칩n"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 bg-slate-900 text-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black tracking-tighter italic",children:["#",t.numero_orden]}),e.jsx("p",{className:"text-[10px] font-bold text-blue-300 uppercase tracking-widest mt-1",children:"Detalles de tu Orden"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:"Total a Pagar"}),e.jsx("div",{className:"text-xl font-black",children:u(t.total)})]})]}),e.jsx("div",{className:"p-6 overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-4 text-left text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Producto"}),e.jsx("th",{className:"pb-4 text-center text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Cant."}),e.jsx("th",{className:"pb-4 text-right text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:(h=t.detalles)==null?void 0:h.map(s=>{var a;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"py-4",children:e.jsx("div",{className:"font-bold text-slate-800 text-sm",children:((a=s.item)==null?void 0:a.nombre)||"Producto"})}),e.jsx("td",{className:"py-4 text-center font-black text-slate-600",children:s.cantidad}),e.jsx("td",{className:"py-4 text-right font-black text-slate-900",children:u(s.total)})]},s.id)})})]})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl shadow-blue-900/5 border border-slate-200 flex flex-col h-[600px] sticky top-6",children:[e.jsxs("div",{className:"p-4 border-b bg-blue-600 text-white rounded-t-2xl flex items-center justify-between shadow-sm z-10",children:[e.jsxs("h3",{className:"font-black text-xs uppercase tracking-widest flex items-center gap-2",children:[e.jsx(b,{size:18,className:"text-blue-200"})," SpacioArte Chat"]}),e.jsxs("span",{className:"flex items-center gap-1.5 px-2 py-1 bg-white/20 rounded-full",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[9px] font-black text-white",children:"EN VIVO"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50",children:[n.length===0&&e.jsxs("div",{className:"text-center py-20 opacity-40",children:[e.jsx(b,{size:40,className:"mx-auto mb-3 text-slate-400"}),e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:["쯊ienes dudas o cambios?",e.jsx("br",{}),"춰Escr칤benos!"]})]}),n.map((s,a)=>e.jsx("div",{className:`flex ${s.emisor==="cliente"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] p-4 rounded-2xl shadow-sm ${s.emisor==="sistema"?"bg-green-100 text-green-800 w-full text-center border border-green-200 text-[10px] uppercase font-black tracking-widest":s.emisor==="cliente"?"bg-slate-800 text-white rounded-tr-none":"bg-white text-slate-800 border border-slate-200 rounded-tl-none"}`,children:[e.jsx("p",{className:`text-xs leading-relaxed ${s.emisor!=="sistema"&&"font-bold"}`,children:s.texto}),s.requiere_aprobacion&&s.emisor==="staff"&&t.estado_diseno==="Pendiente"&&e.jsx("div",{className:"mt-3 py-2 px-3 bg-yellow-100 text-yellow-800 text-[9px] font-black rounded-lg uppercase border border-yellow-200",children:"游녡 REQUIERE TU APROBACI칍N"}),s.emisor!=="sistema"&&e.jsx("div",{className:"text-[8px] mt-2 opacity-50 text-right font-black italic",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},a)),e.jsx("div",{ref:p})]}),e.jsxs("form",{onSubmit:m,className:"p-4 border-t bg-white rounded-b-2xl shadow-[0_-10px_15px_-3px_rgba(0,0,0,0.05)]",children:[e.jsx("textarea",{value:i,onChange:s=>o(s.target.value),placeholder:"Escribe tu mensaje aqu칤...",className:"w-full border border-slate-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-blue-600 focus:border-transparent h-20 bg-slate-50 p-3 shadow-inner placeholder:text-slate-400 mb-3 resize-none transition-all",onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),m(s))}}),e.jsx("button",{type:"submit",disabled:!i||d,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-black text-xs flex items-center justify-center gap-2 disabled:opacity-50 hover:bg-blue-700 transition-all hover:scale-[1.02] active:scale-95 shadow-lg shadow-blue-600/30",children:d?"ENVIANDO...":e.jsxs(e.Fragment,{children:[e.jsx(A,{size:16})," ENVIAR MENSAJE"]})})]})]})})]})]})]}):null}export{O as default};
