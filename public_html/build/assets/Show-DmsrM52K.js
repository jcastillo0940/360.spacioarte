import{r,P as R,j as e,H as z,b as O,a as m}from"./app-DUrg3GOp.js";import{P as S}from"./package-BUOS5zdk.js";import{C as _}from"./circle-alert-Bnp0OHdF.js";import{C as P}from"./circle-x-C6CFEh8J.js";import{C as $}from"./circle-check-big-CAA8OcLA.js";import{M as A}from"./message-square-yxFNieye.js";import{S as L}from"./send-m1AOuY-A.js";import"./createLucideIcon-BwXySn9r.js";function Q({orden:t,max_intentos:o}){var y,E;const[x,b]=r.useState([]),[c,h]=r.useState(""),[g,f]=r.useState(!1),[p,j]=r.useState(""),[w,d]=r.useState(!1),N=r.useRef(null),C=()=>{var s;(s=N.current)==null||s.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{C()},[x]),r.useEffect(()=>{if(!(t!=null&&t.tracking_token))return;const s=new R("cbd8be0eaf6853d5161c",{cluster:"mt1",forceTLS:!0,enabledTransports:["ws","wss"]});return s.subscribe(`chat.${t.tracking_token}`).bind("nuevo-mensaje",function(l){const i=l.mensaje||l;b(u=>u.some(n=>n.id&&n.id===i.id||n.texto===i.texto&&n.created_at===i.created_at&&n.emisor===i.emisor)?u:[...u,i])}),()=>{s.unsubscribe(`chat.${t.tracking_token}`),s.disconnect()}},[t==null?void 0:t.tracking_token]);const v=async s=>{if(s.preventDefault(),!c)return;f(!0);const a={id:Date.now(),texto:c,emisor:"cliente",created_at:new Date().toISOString(),requiere_aprobacion:!1};b(l=>[...l,a]);try{await O.post("/api/ventas/enviar-chat",{mensaje:a,token:t.tracking_token}),h("")}catch(l){console.error("Falla al enviar mensaje a Pusher:",l)}finally{f(!1)}},D=()=>{confirm("¬øEst√°s seguro de que deseas APROBAR este dise√±o? Una vez aprobado, tu orden pasar√° a producci√≥n y no se podr√°n hacer cambios.")&&m.post(`/tracking/${t.tracking_token}/approve`,{},{preserveScroll:!0})},T=s=>{s.preventDefault(),p&&m.post(`/tracking/${t.tracking_token}/reject`,{comentarios:p},{preserveScroll:!0,onSuccess:()=>{d(!1),j("")}})},I=()=>{confirm("¬øDeseas autorizar la continuaci√≥n del dise√±o bajo el esquema de tarifas por horas adicionales?")&&m.post(`/tracking/${t.tracking_token}/approve-billing`,{},{preserveScroll:!0})},k=s=>s==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return t?e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans text-slate-800 selection:bg-blue-200",children:[e.jsx(z,{title:`Seguimiento Orden #${t.numero_orden}`}),e.jsxs("div",{className:"bg-white border-b border-slate-200 px-6 py-4 flex justify-between items-center shadow-sm",children:[e.jsxs("div",{className:"font-black text-xl text-blue-900 tracking-tighter flex items-center gap-2",children:[e.jsx(S,{size:24,className:"text-blue-600"}),"PORTAL DEL CLIENTE"]}),e.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"SpacioArte"})]}),e.jsxs("div",{className:"max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 space-y-6",children:[t.estado_diseno==="Enviado"&&!w&&e.jsxs("div",{className:"bg-white rounded-3xl border border-blue-500 shadow-2xl overflow-hidden animate-fade-in-up",children:[e.jsxs("div",{className:"bg-blue-600 text-white p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-2xl uppercase tracking-tighter italic",children:"NUEVA PROPUESTA DE DISE√ëO"}),e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-blue-100",children:["Intento ",t.diseno_intentos," de ",o||3]})]}),e.jsx("div",{className:"flex gap-3",children:t.diseno_intentos>=(o||3)&&!t.diseno_cobro_aprobado?e.jsxs("button",{onClick:I,className:"bg-yellow-400 text-yellow-950 px-8 py-3 rounded-xl font-black text-xs uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-xl flex items-center gap-2",children:[e.jsx(_,{size:16}),"Aprobar Cobro por Revisiones"]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(!0),className:"bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-xl font-black text-xs uppercase transition-all",children:"Solicitar Cambios"}),e.jsx("button",{onClick:D,className:"bg-white text-blue-600 px-8 py-3 rounded-xl font-black text-xs uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-xl",children:"Aprobar Dise√±o"})]})})]}),e.jsx("div",{className:"p-8 bg-slate-100 flex items-center justify-center",children:e.jsx("div",{className:"bg-white p-4 rounded-3xl shadow-sm border border-slate-200 max-w-2xl w-full",children:e.jsx("img",{src:`/storage/${t.imagen_diseno}`,alt:"Dise√±o Propuesto",className:"w-full h-auto rounded-2xl shadow-inner border border-slate-100"})})})]}),w&&e.jsxs("div",{className:"bg-white rounded-3xl border border-red-500 shadow-2xl p-8 space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-slate-100 pb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-2xl text-slate-900",children:"CU√âNTANOS TUS CAMBIOS"}),e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:t.diseno_intentos<(o||3)?`Te quedan ${(o||3)-t.diseno_intentos} revisiones gratuitas.`:"Se ha alcanzado el l√≠mite gratuito. Las siguientes revisiones tendr√°n costo por hora."})]}),e.jsx("button",{onClick:()=>d(!1),className:"text-slate-400 hover:text-slate-900 transition-colors",children:e.jsx(P,{size:24})})]}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsx("textarea",{value:p,onChange:s=>j(s.target.value),placeholder:"S√© lo m√°s espec√≠fico posible. ¬øQu√© colores, tama√±os o textos te gustar√≠a cambiar?",className:"w-full h-40 bg-slate-50 border-none rounded-2xl p-6 text-sm font-bold focus:ring-2 focus:ring-red-500 transition-all shadow-inner",required:!0}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-8 py-4 rounded-2xl font-black text-xs uppercase text-slate-500 hover:bg-slate-50 transition-all",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-red-600 text-white px-10 py-4 rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl shadow-red-600/20 hover:scale-105 active:scale-95 transition-all",children:"Enviar Comentarios"})]})]})]}),t.estado_diseno==="Pendiente"&&e.jsx("div",{className:"bg-yellow-400 text-yellow-950 rounded-2xl p-6 shadow-lg shadow-yellow-400/20 flex flex-col sm:flex-row justify-between items-center gap-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(_,{size:32,className:"text-yellow-700 shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg uppercase tracking-tighter",children:"¬°Esperando tu Dise√±o!"}),e.jsx("p",{className:"text-sm font-medium mt-1 opacity-90 max-w-xl",children:"Nuestros dise√±adores est√°n trabajando en tu pedido. En cuanto est√© listo, aparecer√° aqu√≠ para que puedas revisarlo y aprobarlo."})]})]})}),["Dise√±o Aprobado","En Impresi√≥n","En Producci√≥n","En Espera de Entrega"].includes(t.estado)&&e.jsxs("div",{className:`rounded-3xl p-6 shadow-lg flex flex-col sm:flex-row items-center justify-between gap-6 overflow-hidden relative group transition-all duration-500 ${t.estado==="En Espera de Entrega"?"bg-emerald-600 text-white shadow-emerald-500/20":"bg-green-500 text-white shadow-green-500/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-6 z-10",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center animate-pulse",children:t.estado==="En Espera de Entrega"?e.jsx(S,{size:24}):e.jsx($,{size:24})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-black text-xl uppercase tracking-tighter italic leading-none",children:[t.estado==="Dise√±o Aprobado"&&"¬°Dise√±o Aprobado! Pasando a producci√≥n",t.estado==="En Impresi√≥n"&&"Tu orden est√° en fase de impresi√≥n",t.estado==="En Producci√≥n"&&"Estamos trabajando en el acabado final",t.estado==="En Espera de Entrega"&&"¬°TODO LISTO! TU PEDIDO TE ESPERA"]}),e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-white/60 mt-2",children:["√öLTIMA ACTUALIZACI√ìN: ",new Date().toLocaleDateString()]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 px-6 py-2 bg-black/10 rounded-full font-black text-[10px] tracking-widest uppercase z-10",children:[e.jsx("span",{className:"w-2 h-2 bg-white rounded-full animate-ping"}),"TRABAJO ACTIVO"]}),e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -mr-32 -mt-32 blur-3xl group-hover:bg-white/10 transition-colors"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.imagen_referencia&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-slate-50 border-b border-slate-100",children:e.jsx("h3",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:"Referencia de tu pedido"})}),e.jsxs("div",{className:"p-6 flex gap-6 items-start",children:[e.jsx("img",{src:`/storage/${t.imagen_referencia}`,className:"w-32 h-32 object-cover rounded-xl shadow-sm border border-slate-100"}),e.jsx("div",{children:e.jsx("p",{className:"text-xs font-bold text-slate-500 leading-relaxed uppercase",children:"Esta es la imagen que enviamos como base para tu dise√±o. Nuestros dise√±adores la est√°n usando como gu√≠a principal."})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 bg-slate-900 text-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black tracking-tighter italic",children:["#",t.numero_orden]}),e.jsx("p",{className:"text-[10px] font-bold text-blue-300 uppercase tracking-widest mt-1",children:"Detalles de tu Orden"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:"Total a Pagar"}),e.jsx("div",{className:"text-xl font-black",children:k(t.total)})]})]}),e.jsx("div",{className:"p-6 overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-4 text-left text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Producto"}),e.jsx("th",{className:"pb-4 text-center text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Cant."}),e.jsx("th",{className:"pb-4 text-right text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:(y=t.detalles)==null?void 0:y.map(s=>{var a;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"py-4",children:e.jsx("div",{className:"font-bold text-slate-800 text-sm",children:((a=s.item)==null?void 0:a.nombre)||"Producto"})}),e.jsx("td",{className:"py-4 text-center font-black text-slate-600",children:s.cantidad}),e.jsx("td",{className:"py-4 text-right font-black text-slate-900",children:k(s.total)})]},s.id)})})]})})]}),((E=t.diseno_historial)==null?void 0:E.length)>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400 ml-2",children:"Historial de Revisiones"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:t.diseno_historial.map(s=>e.jsxs("div",{className:"bg-white rounded-2xl p-4 border border-slate-200 flex gap-4",children:[e.jsx("img",{src:`/storage/${s.imagen}`,className:"w-20 h-20 object-cover rounded-lg border border-slate-100"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[10px] font-black text-slate-400",children:["REV #",s.intento]}),e.jsx("span",{className:`text-[8px] font-black px-2 py-0.5 rounded-full uppercase ${s.estado==="Aprobado"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:s.estado})]}),e.jsx("p",{className:"text-[9px] font-bold text-slate-600 italic line-clamp-2",children:s.comentarios_cliente||"Sin comentarios."}),e.jsx("p",{className:"text-[8px] text-slate-400 font-bold",children:new Date(s.created_at).toLocaleDateString()})]})]},s.id))})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl shadow-blue-900/5 border border-slate-200 flex flex-col h-[600px] sticky top-6",children:[e.jsxs("div",{className:"p-4 border-b bg-blue-600 text-white rounded-t-2xl flex items-center justify-between shadow-sm z-10",children:[e.jsxs("h3",{className:"font-black text-xs uppercase tracking-widest flex items-center gap-2",children:[e.jsx(A,{size:18,className:"text-blue-200"})," SpacioArte Chat"]}),e.jsxs("span",{className:"flex items-center gap-1.5 px-2 py-1 bg-white/20 rounded-full",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-[9px] font-black text-white",children:"EN VIVO"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50",children:[x.length===0&&e.jsxs("div",{className:"text-center py-20 opacity-40",children:[e.jsx(A,{size:40,className:"mx-auto mb-3 text-slate-400"}),e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500",children:["¬øTienes dudas o cambios?",e.jsx("br",{}),"¬°Escr√≠benos!"]})]}),x.map((s,a)=>e.jsx("div",{className:`flex ${s.emisor==="cliente"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] p-4 rounded-2xl shadow-sm ${s.emisor==="sistema"?"bg-green-100 text-green-800 w-full text-center border border-green-200 text-[10px] uppercase font-black tracking-widest":s.emisor==="cliente"?"bg-slate-800 text-white rounded-tr-none":"bg-white text-slate-800 border border-slate-200 rounded-tl-none"}`,children:[e.jsx("p",{className:`text-xs leading-relaxed ${s.emisor!=="sistema"&&"font-bold"}`,children:s.texto}),s.image_url&&e.jsx("img",{src:s.image_url,className:"mt-3 rounded-xl border border-slate-100 shadow-sm"}),s.requiere_aprobacion&&s.emisor==="staff"&&e.jsx("div",{className:"mt-3 py-2 px-3 bg-yellow-100 text-yellow-800 text-[9px] font-black rounded-lg uppercase border border-yellow-200",children:"üëÜ REQUIERE TU REVISI√ìN"}),s.requiere_aprobacion_cobro&&s.emisor==="staff"&&!t.diseno_cobro_aprobado&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-2xl flex flex-col gap-3",children:[e.jsx("p",{className:"text-[10px] font-black text-blue-900 uppercase leading-normal",children:"‚ö†Ô∏è L√çMITE DE REVISIONES GRATUITAS ALCANZADO."}),e.jsx("p",{className:"text-[9px] font-bold text-blue-700",children:'Favor utilice el bot√≥n superior "Aprobar Cobro por Revisiones" para continuar con el proceso.'})]}),s.emisor!=="sistema"&&e.jsx("div",{className:"text-[8px] mt-2 opacity-50 text-right font-black italic",children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},a)),e.jsx("div",{ref:N})]}),e.jsxs("form",{onSubmit:v,className:"p-4 border-t bg-white rounded-b-2xl shadow-[0_-10px_15px_-3px_rgba(0,0,0,0.05)]",children:[e.jsx("textarea",{value:c,onChange:s=>h(s.target.value),placeholder:"Escribe tu mensaje aqu√≠...",className:"w-full border border-slate-200 rounded-xl text-xs font-bold focus:ring-2 focus:ring-blue-600 focus:border-transparent h-20 bg-slate-50 p-3 shadow-inner placeholder:text-slate-400 mb-3 resize-none transition-all",onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),v(s))}}),e.jsx("button",{type:"submit",disabled:!c||g,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-black text-xs flex items-center justify-center gap-2 disabled:opacity-50 hover:bg-blue-700 transition-all hover:scale-[1.02] active:scale-95 shadow-lg shadow-blue-600/30",children:g?"ENVIANDO...":e.jsxs(e.Fragment,{children:[e.jsx(L,{size:16})," ENVIAR MENSAJE"]})})]})]})})]})]})]}):null}export{Q as default};
