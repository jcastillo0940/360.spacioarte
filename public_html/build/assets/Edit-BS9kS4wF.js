import{r as l,j as e,H as N,a as _}from"./app-FXXXkb3F.js";import{A as w}from"./AuthenticatedLayout-BxxwF24W.js";/* empty css            */function Y({ordenId:u}){const[i,y]=l.useState(null),[C,S]=l.useState([]),[k,F]=l.useState([]),[h,E]=l.useState([]),[b,x]=l.useState([]),[L,p]=l.useState(!0),[$,g]=l.useState(""),[I,m]=l.useState(!1),[t,d]=l.useState({contacto_id:"",vendedor_id:"",fecha_emision:"",fecha_entrega:"",estado:"",items:[]}),[V,B]=l.useState(0),[P,T]=l.useState(0),[z,M]=l.useState(0),f=s=>{if(!s)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(s))return s;const a=new Date(s),o=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0");return`${o}-${r}-${n}`};l.useEffect(()=>{console.log("Cargando datos para orden:",u),Promise.all([fetch(`/api/ventas/ordenes/${u}`).then(s=>s.json()),fetch("/api/ventas/ordenes/datos").then(s=>s.json())]).then(([s,a])=>{var r;console.log("âœ… Orden recibida:",s),console.log("âœ… Datos auxiliares:",a),y(s),S(a.clientes||[]),F(a.vendedores||[]),E(a.productos||[]),x(a.productos||[]);const o={contacto_id:String(s.contacto_id||""),vendedor_id:s.vendedor_id?String(s.vendedor_id):"",fecha_emision:f(s.fecha_emision),fecha_entrega:f(s.fecha_entrega),estado:s.estado||"",items:((r=s.detalles)==null?void 0:r.map(n=>{var v;return{item_id:n.item_id,nombre:((v=n.item)==null?void 0:v.nombre)||"Producto",cantidad:parseFloat(n.cantidad),precio_unitario:parseFloat(n.precio_unitario)}}))||[]};console.log("âœ… Datos a cargar en formulario:",o),d(o),p(!1)}).catch(s=>{console.error("âŒ Error loading data:",s),p(!1)})},[u]);const H=s=>{if(g(s),s.length===0)x(h),m(!1);else{const a=h.filter(o=>o.nombre.toLowerCase().includes(s.toLowerCase())||o.codigo.toLowerCase().includes(s.toLowerCase()));x(a),m(!0)}},O=s=>{if(t.items.find(o=>o.item_id===s.id)){const o=t.items.map(r=>r.item_id===s.id?{...r,cantidad:r.cantidad+1}:r);d({...t,items:o})}else{const o={item_id:s.id,nombre:s.nombre,cantidad:1,precio_unitario:s.precio_venta||0};d({...t,items:[...t.items,o]})}g(""),m(!1)},q=s=>{d({...t,items:t.items.filter(a=>a.item_id!==s)})},j=(s,a,o)=>{const r=t.items.map(n=>n.item_id===s?{...n,[a]:parseFloat(o)||0}:n);d({...t,items:r})},c=(s,a)=>{d({...t,[s]:a})};l.useEffect(()=>{const s=t.items.reduce((r,n)=>r+n.cantidad*n.precio_unitario,0),a=s*.07,o=s+a;B(s),T(a),M(o)},[t.items]);const A=s=>{s.preventDefault(),console.log("ðŸ“¤ Enviando datos:",t),_.put(`/ventas/ordenes/${u}`,t,{onSuccess:()=>{_.visit("/ventas/ordenes")},onError:a=>{console.error("âŒ Errores:",a)}})};return L?e.jsxs(w,{children:[e.jsx(N,{title:"Editando..."}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4",children:"Cargando orden..."})]})})]}):e.jsxs(w,{children:[e.jsx(N,{title:`Editar ${i==null?void 0:i.numero_orden}`}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-900 flex items-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Editar Orden de Venta"]}),e.jsx("p",{className:"text-slate-600 mt-2 font-mono text-lg",children:i==null?void 0:i.numero_orden})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"InformaciÃ³n General"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Cliente *"}),e.jsxs("select",{value:t.contacto_id,onChange:s=>c("contacto_id",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),C.map(s=>e.jsx("option",{value:s.id,children:s.razon_social},s.id))]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Valor actual: ",t.contacto_id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Vendedor"}),e.jsxs("select",{value:t.vendedor_id,onChange:s=>c("vendedor_id",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",children:[e.jsx("option",{value:"",children:"Sin asignar"}),k.map(s=>e.jsx("option",{value:s.id,children:s.nombre_completo},s.id))]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Valor actual: ",t.vendedor_id||"ninguno"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Fecha EmisiÃ³n *"}),e.jsx("input",{type:"date",value:t.fecha_emision,onChange:s=>c("fecha_emision",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",required:!0}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Valor: ",t.fecha_emision]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Fecha Entrega"}),e.jsx("input",{type:"date",value:t.fecha_entrega,onChange:s=>c("fecha_entrega",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition"}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Valor: ",t.fecha_entrega]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Estado *"}),e.jsxs("select",{value:t.estado,onChange:s=>c("estado",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar..."}),e.jsx("option",{value:"Borrador",children:"Borrador"}),e.jsx("option",{value:"Confirmada",children:"Confirmada"}),e.jsx("option",{value:"Facturada",children:"Facturada"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"})]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Valor actual: ",t.estado]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Buscar Producto"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:$,onChange:s=>H(s.target.value),placeholder:"Buscar por nombre o cÃ³digo...",className:"w-full px-4 py-3 rounded-lg border border-slate-300",autoComplete:"off"}),I&&b.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-64 overflow-y-auto",children:b.map(s=>e.jsxs("button",{type:"button",onClick:()=>O(s),className:"w-full text-left p-3 hover:bg-blue-50 border-b transition",children:[e.jsx("div",{className:"font-bold",children:s.nombre}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.codigo," â€¢ $",s.precio_venta]})]},s.id))})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4",children:["Items (",t.items.length,")"]}),t.items.length===0?e.jsx("p",{className:"text-center text-slate-400 py-8",children:"No hay productos agregados"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b-2",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-3 text-left text-xs font-bold uppercase",children:"Producto"}),e.jsx("th",{className:"pb-3 text-center text-xs font-bold uppercase",children:"Cant."}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase",children:"Precio"}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase",children:"Total"}),e.jsx("th",{className:"pb-3"})]})}),e.jsx("tbody",{className:"divide-y",children:t.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-medium",children:s.nombre}),e.jsx("td",{className:"py-3",children:e.jsx("input",{type:"number",className:"w-20 mx-auto text-center px-2 py-2 border rounded-lg",value:s.cantidad,onChange:a=>j(s.item_id,"cantidad",a.target.value),step:"0.01",min:"0"})}),e.jsx("td",{className:"py-3",children:e.jsx("input",{type:"number",step:"0.01",className:"w-28 ml-auto text-right px-2 py-2 border rounded-lg",value:s.precio_unitario,onChange:a=>j(s.item_id,"precio_unitario",a.target.value),min:"0"})}),e.jsxs("td",{className:"py-3 text-right font-bold text-blue-600",children:["$",(s.cantidad*s.precio_unitario).toFixed(2)]}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>q(s.item_id),className:"text-red-500 hover:text-red-700 transition",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},s.item_id))})]})})]})]}),e.jsxs("div",{className:"bg-blue-800 text-white p-6 rounded-lg shadow-lg h-fit sticky top-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-6",children:"Resumen"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"font-bold",children:["$",V.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"ITBMS (7%):"}),e.jsxs("span",{className:"font-bold",children:["$",P.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex justify-between text-2xl font-black border-t border-blue-700 pt-4",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",z.toFixed(2)]})]}),e.jsx("button",{type:"submit",disabled:t.items.length===0,className:"w-full bg-blue-600 text-white mt-6 py-4 rounded-lg font-bold hover:bg-blue-500 transition disabled:bg-slate-600 disabled:cursor-not-allowed",children:"Actualizar Orden"})]})]})]})]})]})}export{Y as default};
