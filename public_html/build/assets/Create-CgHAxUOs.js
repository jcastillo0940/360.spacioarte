import{r as o,u as D,j as e,H as w}from"./app-3DoqhR_o.js";import{A as k}from"./AuthenticatedLayout-314zbiSn.js";function W(){const[y,u]=o.useState([]),[h,p]=o.useState([]),[c,d]=o.useState([]),[C,g]=o.useState(!0),[x,b]=o.useState(""),[j,i]=o.useState(!1),{data:t,setData:l,post:_,processing:f,errors:v}=D({contacto_id:"",fecha_pedido:new Date().toISOString().split("T")[0],fecha_entrega:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],items:[]}),[L,S]=o.useState(0);o.useEffect(()=>{M()},[]);const M=()=>{fetch("/api/compras/ordenes/datos").then(s=>s.json()).then(s=>{u(s.proveedores||[]),p(s.productos||[]),d(s.productos||[]),g(!1)}).catch(s=>{console.error("Error loading data:",s),u([]),p([]),d([]),g(!1)})},F=s=>{if(b(s),s.length===0)d(h),i(!1);else{const a=h.filter(r=>r.nombre.toLowerCase().includes(s.toLowerCase())||r.codigo.toLowerCase().includes(s.toLowerCase())||r.categoria&&r.categoria.toLowerCase().includes(s.toLowerCase()));d(a),i(!0)}},P=s=>{if(t.items.find(r=>r.item_id===s.id)){const r=t.items.map(n=>n.item_id===s.id?{...n,cantidad:n.cantidad+1}:n);l("items",r)}else{const r={item_id:s.id,nombre:s.nombre,cantidad:1,costo_unitario:s.costo_promedio||0};l("items",[...t.items,r])}b(""),i(!1)},B=s=>{l("items",t.items.filter(a=>a.item_id!==s))},N=(s,a,r)=>{const n=t.items.map(m=>m.item_id===s?{...m,[a]:parseFloat(r)||0}:m);l("items",n)};o.useEffect(()=>{const s=t.items.reduce((a,r)=>a+r.cantidad*r.costo_unitario,0);S(s)},[t.items]);const I=s=>{s.preventDefault(),_(route("compras.ordenes.store"))};return C?e.jsxs(k,{children:[e.jsx(w,{title:"Nueva Orden de Compra"}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4",children:"Cargando datos..."})]})})]}):e.jsxs(k,{children:[e.jsx(w,{title:"Nueva Orden de Compra"}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-900 flex items-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),"Nueva Orden de Compra"]}),e.jsx("p",{className:"text-slate-600 mt-2",children:"Pedido de mercancía a proveedores"})]}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Proveedor y Fechas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Proveedor *"}),e.jsxs("select",{value:t.contacto_id,onChange:s=>l("contacto_id",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition",required:!0,children:[e.jsx("option",{value:"",children:"Seleccione un proveedor"}),y.map(s=>e.jsx("option",{value:s.id,children:s.razon_social},s.id))]}),v.contacto_id&&e.jsx("span",{className:"text-red-500 text-xs",children:v.contacto_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Fecha Pedido"}),e.jsx("input",{type:"date",value:t.fecha_pedido,onChange:s=>l("fecha_pedido",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Fecha Entrega Estimada"}),e.jsx("input",{type:"date",value:t.fecha_entrega,onChange:s=>l("fecha_entrega",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition",required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Buscar Producto"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:x,onChange:s=>F(s.target.value),onFocus:()=>x&&i(!0),placeholder:"Buscar por nombre, código o categoría...",className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition",autoComplete:"off"}),j&&c.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-64 overflow-y-auto",children:c.map(s=>e.jsx("button",{type:"button",onClick:()=>P(s),className:"w-full text-left p-3 hover:bg-green-50 border-b border-slate-100 last:border-0 transition",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-slate-900",children:s.nombre}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[e.jsx("span",{className:"font-mono",children:s.codigo}),s.categoria&&e.jsxs("span",{className:"ml-2",children:["• ",s.categoria]})]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsxs("div",{className:"text-xs text-slate-500",children:["Stock: ",s.stock_actual||"N/A"]})})]})},s.id))}),j&&x&&c.length===0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron productos"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),"Items a Comprar (",t.items.length,")"]}),t.items.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("p",{className:"font-bold",children:"No hay productos añadidos"}),e.jsx("p",{className:"text-sm mt-1",children:"Usa el buscador para agregar productos"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b-2 border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-3 text-left text-xs font-bold uppercase text-slate-600",children:"Producto"}),e.jsx("th",{className:"pb-3 text-center text-xs font-bold uppercase text-slate-600",children:"Cant."}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase text-slate-600",children:"Costo Unit."}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase text-slate-600",children:"Total"}),e.jsx("th",{className:"pb-3"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:t.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-medium text-slate-900",children:s.nombre}),e.jsx("td",{className:"py-3",children:e.jsx("input",{type:"number",className:"w-20 mx-auto text-center px-2 py-2 border border-slate-300 rounded-lg focus:border-green-500 focus:ring-1 focus:ring-green-500",value:s.cantidad,onChange:a=>N(s.item_id,"cantidad",a.target.value),min:"0.01",step:"0.01"})}),e.jsx("td",{className:"py-3",children:e.jsx("input",{type:"number",step:"0.01",className:"w-24 ml-auto text-right px-2 py-2 border border-slate-300 rounded-lg focus:border-green-500 focus:ring-1 focus:ring-green-500",value:s.costo_unitario,onChange:a=>N(s.item_id,"costo_unitario",a.target.value)})}),e.jsxs("td",{className:"py-3 text-right font-bold text-slate-900",children:["$",(s.cantidad*s.costo_unitario).toFixed(2)]}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>B(s.item_id),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},s.item_id))})]})]})]}),e.jsxs("div",{className:"bg-green-800 text-white p-6 rounded-lg shadow-lg h-fit sticky top-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-6",children:"Resumen"}),e.jsxs("div",{className:"flex justify-between text-2xl font-black border-t border-green-700 pt-4",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",L.toFixed(2)]})]}),e.jsxs("button",{type:"submit",disabled:f||t.items.length===0||!t.contacto_id,className:"w-full bg-green-600 text-white mt-6 py-4 rounded-lg font-bold hover:bg-green-500 transition disabled:bg-slate-600 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),f?"Procesando...":"Generar Orden de Compra"]})]})]})]})]})]})}export{W as default};
