import{r as o,j as e,H as F,L as g,b as h}from"./app-BqyPfEI0.js";import{A as f}from"./AuthenticatedLayout-ChjIDkpR.js";function z(){const[r,u]=o.useState([]),[j,v]=o.useState([]),[N,m]=o.useState(!0),[l,n]=o.useState([]),[w,c]=o.useState(!1),[x,k]=o.useState("");o.useEffect(()=>{d(),y()},[]);const d=()=>{fetch("/api/ventas/ordenes").then(t=>t.json()).then(t=>{u(t||[]),m(!1)}).catch(t=>{console.error("Error loading ordenes:",t),u([]),m(!1)})},y=()=>{fetch("/api/inventario/contactos").then(t=>t.json()).then(t=>{const s=Array.isArray(t)?t.filter(a=>a.es_proveedor):[];v(s)})},C=t=>{confirm("¿Convertir esta orden en factura de venta? Se actualizará el inventario y se registrará la venta.")&&h.post(`/ventas/facturas/convertir/${t}`,{},{onSuccess:()=>d()})},L=t=>{n(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},S=()=>{if(!x)return alert("Seleccione un proveedor");h.post(route("compras.consolidar.store"),{venta_ids:l,contacto_id:x},{onSuccess:()=>{c(!1),n([]),d()}})},P=t=>({Borrador:"bg-slate-100 text-slate-700 border-slate-200",Confirmada:"bg-blue-100 text-blue-700 border-blue-200",Diseño:"bg-purple-100 text-purple-700 border-purple-200","Pre-Prensa":"bg-cyan-100 text-cyan-700 border-cyan-200",Producción:"bg-indigo-100 text-indigo-700 border-indigo-200",Terminado:"bg-green-100 text-green-700 border-green-200",Entregado:"bg-emerald-600 text-white",Facturada:"bg-green-100 text-green-700 border-green-200",Cancelado:"bg-red-100 text-red-700 border-red-200"}[t]||"bg-slate-100 text-slate-700 border-slate-200")+" border font-black",b=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0),i={total:r.length,confirmadas:r.filter(t=>t.estado==="Confirmada").length,facturadas:r.filter(t=>t.estado==="Facturada").length,valorTotal:r.reduce((t,s)=>t+parseFloat(s.total||0),0)};return N?e.jsx(f,{children:e.jsxs("div",{className:"max-w-7xl mx-auto p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4 font-bold",children:"Cargando órdenes..."})]})}):e.jsxs(f,{children:[e.jsx(F,{title:"Órdenes de Venta"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-900 flex items-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Órdenes de Venta"]}),e.jsx("p",{className:"text-slate-600 mt-2 font-medium",children:"Gestión de pedidos y consolidación de compras"})]}),e.jsxs("div",{className:"flex gap-3",children:[l.length>0&&e.jsxs("button",{onClick:()=>c(!0),className:"px-6 py-3 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition flex items-center gap-2 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),"Consolidar (",l.length,")"]}),e.jsxs(g,{href:route("ordenes.create"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition shadow-lg flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nueva Orden"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm",children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Total Pedidos"}),e.jsx("div",{className:"text-3xl font-black text-slate-900 mt-1",children:i.total})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-blue-500",children:[e.jsx("div",{className:"text-xs font-bold text-blue-500 uppercase tracking-wider",children:"Confirmadas"}),e.jsx("div",{className:"text-3xl font-black text-slate-900 mt-1",children:i.confirmadas})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-green-500",children:[e.jsx("div",{className:"text-xs font-bold text-green-500 uppercase tracking-wider",children:"Facturadas"}),e.jsx("div",{className:"text-3xl font-black text-slate-900 mt-1",children:i.facturadas})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-slate-900",children:[e.jsx("div",{className:"text-xs font-bold text-slate-900 uppercase tracking-wider",children:"Valor Global"}),e.jsx("div",{className:"text-3xl font-black text-slate-900 mt-1",children:b(i.valorTotal)})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-900 text-white text-xs uppercase font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 w-10 text-center",children:e.jsx("input",{type:"checkbox",className:"rounded border-slate-700 text-blue-600 focus:ring-blue-500 bg-slate-800 cursor-pointer",onChange:t=>{if(t.target.checked){const s=r.filter(a=>a.estado!=="Facturada").map(a=>a.id);n(s)}else n([])}})}),e.jsx("th",{className:"px-6 py-4",children:"Orden #"}),e.jsx("th",{className:"px-6 py-4",children:"Cliente / RUC"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Monto Total"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Estado"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-10 text-center text-slate-400 font-medium",children:"No se encontraron registros."})}):r.map(t=>{var s,a;return e.jsxs("tr",{className:`${l.includes(t.id)?"bg-blue-50":t.estado==="Facturada"?"bg-slate-50 opacity-60":"hover:bg-slate-50"} transition-colors`,children:[e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",checked:l.includes(t.id),disabled:t.estado==="Facturada",onChange:()=>L(t.id),className:`rounded border-slate-300 focus:ring-blue-500 ${t.estado==="Facturada"?"cursor-not-allowed":"text-blue-600 cursor-pointer"}`})}),e.jsx("td",{className:"px-6 py-4 font-mono font-bold text-slate-900",children:t.numero_orden}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-bold text-slate-900",children:(s=t.cliente)==null?void 0:s.razon_social}),e.jsx("div",{className:"text-xs text-slate-500",children:(a=t.cliente)==null?void 0:a.identificacion})]}),e.jsx("td",{className:"px-6 py-4 text-right font-black text-slate-900",children:b(t.total)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("select",{value:t.estado,onChange:p=>{confirm(`¿Cambiar estado a ${p.target.value}?`)&&h.put(route("ordenes.estado",t.id),{estado:p.target.value},{onSuccess:()=>d()})},className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter border-0 cursor-pointer ${P(t.estado)}`,children:[e.jsx("option",{value:"Borrador",children:"Borrador"}),e.jsx("option",{value:"Confirmada",children:"Confirmada"}),e.jsx("option",{value:"Diseño",children:"Diseño"}),e.jsx("option",{value:"Pre-Prensa",children:"Nesting"}),e.jsx("option",{value:"Producción",children:"Producción"}),e.jsx("option",{value:"Terminado",children:"Terminado"}),e.jsx("option",{value:"Entregado",children:"Entregado"}),e.jsx("option",{value:"Facturada",children:"Facturada"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(g,{href:route("ordenes.show",t.id),className:"p-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-900 hover:text-white transition shadow-sm",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),t.estado==="Confirmada"&&e.jsx("button",{onClick:()=>C(t.id),className:"p-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-700 hover:text-white transition shadow-sm",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]})})]},t.id)})})]})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full border border-slate-200",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("h3",{className:"text-2xl font-black text-slate-900",children:"Consolidar Compras"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1 mb-6",children:"Selecciona el proveedor al cual se le enviará esta orden unificada."}),e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2",children:"Proveedor del Pedido"}),e.jsxs("select",{className:"w-full rounded-xl border-slate-200 bg-slate-50 py-3 font-bold text-slate-700 focus:ring-indigo-500 focus:border-indigo-500 transition",value:x,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"",children:"Buscar en contactos..."}),j.map(t=>e.jsx("option",{value:t.id,children:t.razon_social||t.nombre},t.id))]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx("button",{onClick:()=>c(!1),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold hover:bg-slate-200 transition",children:"Ignorar"}),e.jsx("button",{onClick:S,className:"flex-1 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-200",children:"Procesar Ahora"})]})]})})]})}export{z as default};
