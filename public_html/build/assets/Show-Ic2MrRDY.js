import{r as n,u as O,P as ae,j as e,H as re,b as o,a as le}from"./app-DUrg3GOp.js";import{A as y}from"./AuthenticatedLayout-C3zTQCkg.js";import{C as ne}from"./circle-alert-Bnp0OHdF.js";import{F as k}from"./file-text-DYIskaRX.js";import{c as j}from"./createLucideIcon-BwXySn9r.js";import{D as ie}from"./dollar-sign-CsEwh1Tu.js";import{T as oe}from"./timer-BGU2pXzE.js";import{C as ce,P as de}from"./play-jG416TBF.js";import{C as f}from"./clock-CZNDVXNt.js";import{S as xe}from"./square-CPOlgSqc.js";import{U as pe}from"./upload-vpWqG4-w.js";import{M as L}from"./message-square-yxFNieye.js";import{C as me}from"./circle-check-big-CAA8OcLA.js";import{S as ue}from"./send-m1AOuY-A.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],F=j("activity",he);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ge=j("copy",be);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],je=j("external-link",fe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],q=j("history",we);function Oe({ordenId:c}){var $,M,T;const[s,U]=n.useState(null),[V,E]=n.useState(!0),[_,C]=n.useState(null),[w,D]=n.useState([]),[h,H]=n.useState([]),[m,S]=n.useState(null),[B,N]=n.useState(0),[z,A]=n.useState(!1),I=n.useRef(null),v=n.useRef(null),{data:d,setData:R,post:Ne,processing:ve,reset:G}=O({imagen:null,comentarios:""}),{data:x,setData:P,processing:Q,reset:X}=O({mensaje_texto:"",requiere_aprobacion:!1}),Y=()=>{var t;(t=I.current)==null||t.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{Y()},[w]);const b=()=>{o.get(`/api/ventas/ordenes/${c}`).then(t=>{var a;if(t.data.error)C(t.data.error);else{U(t.data),o.get(`/api/ventas/ordenes/${c}/historial`).then(l=>H(l.data)).catch(l=>console.error("Error al cargar historial:",l));const r=(a=t.data.tiempos)==null?void 0:a.find(l=>l.hora_fin===null);if(r){S(r);const l=new Date(r.hora_inicio).getTime();N(Math.floor((Date.now()-l)/1e3))}else S(null),N(0)}E(!1)}).catch(t=>{var a,r;console.error("Error al cargar orden:",t),C(((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.error)||"Error de conexión al cargar la orden."),E(!1)})};n.useEffect(()=>{b()},[c]),n.useEffect(()=>(m?v.current=setInterval(()=>{N(t=>t+1)},1e3):clearInterval(v.current),()=>clearInterval(v.current)),[m]),n.useEffect(()=>{if(!(s!=null&&s.tracking_token))return;const t=new ae("cbd8be0eaf6853d5161c",{cluster:"mt1",forceTLS:!0,enabledTransports:["ws","wss"]});return t.subscribe(`chat.${s.tracking_token}`).bind("nuevo-mensaje",function(r){const l=r.mensaje||r;D(i=>i.some(u=>u.id&&u.id===l.id||u.texto===l.texto&&u.created_at===l.created_at&&u.emisor===l.emisor)?i:[...i,l])}),()=>{t.unsubscribe(`chat.${s.tracking_token}`),t.disconnect()}},[s==null?void 0:s.tracking_token]);const g=async(t,a)=>{var r,l;try{t==="start"?await o.post("/api/diseno/timer/start",{orden_id:c,fase:a}):t==="stop"?await o.post("/api/diseno/timer/stop",{orden_id:c,fase:a}):t==="update_status"&&await o.put(`/ventas/ordenes/${c}/estado`,{estado:a}),b()}catch(i){alert("Error al gestionar el proceso: "+(((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.message)||i.message))}},J=async()=>{if(confirm("¿Desea enviar esta orden a RE-IMPRESIÓN? Esto creará nuevas tareas en producción."))try{await o.post(`/api/ventas/ordenes/${c}/reimprimir`),alert("Orden enviada a re-impresión"),b()}catch{alert("Error al generar re-impresión")}},K=async t=>{var r,l;if(t.preventDefault(),!d.imagen)return alert("Seleccione una imagen");const a=new FormData;a.append("imagen",d.imagen),a.append("comentarios",d.comentarios),a.append("numero_orden",s.numero_orden),A(!0);try{await o.post("/api/diseno/upload",a,{headers:{"Content-Type":"multipart/form-data"}}),G(),alert("Diseño subido correctamente"),b()}catch(i){alert("Error: "+(((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.error)||"Falla al subir"))}finally{A(!1)}},W=()=>{confirm("¿Desea generar la factura fiscal?")&&le.post(route("facturas.convertir",s.id))},Z=async t=>{if(t.preventDefault(),!x.mensaje_texto)return;const a={id:Date.now(),texto:x.mensaje_texto,emisor:"staff",created_at:new Date().toISOString(),requiere_aprobacion:x.requiere_aprobacion};D(r=>[...r,a]);try{await o.post("/api/ventas/enviar-chat",{mensaje:a,token:s.tracking_token}),X("mensaje_texto","requiere_aprobacion")}catch(r){console.error("Falla al enviar mensaje:",r)}},ee=()=>{if(!(s!=null&&s.tracking_token)){alert("No hay token de seguimiento generado para esta orden.");return}const t=`${window.location.origin}/tracking/${s.tracking_token}`;navigator.clipboard.writeText(t),alert("Enlace de seguimiento copiado")},te=t=>{const a=Math.floor(t/3600),r=Math.floor(t%3600/60),l=t%60;return[a,r,l].map(i=>i<10?"0"+i:i).join(":")},p=t=>t==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),se=t=>{switch(t){case"Borrador":return"bg-slate-100 text-slate-600 border-slate-200";case"En Proceso de Diseño":return"bg-blue-100 text-blue-700 border-blue-200 animate-pulse";case"Enviado para Aprobación":return"bg-purple-100 text-purple-700 border-purple-200";case"Diseño Rechazado":return"bg-red-100 text-red-700 border-red-200";case"Rediseñando":return"bg-orange-100 text-orange-700 border-orange-200 animate-pulse";case"Diseño Aprobado":return"bg-green-100 text-green-700 border-green-200";case"En Impresión":return"bg-cyan-100 text-cyan-700 border-cyan-200";case"En Producción":return"bg-indigo-100 text-indigo-700 border-indigo-200";case"En Espera de Entrega":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"Entregado":return"bg-emerald-600 text-white border-emerald-700";default:return"bg-slate-100 text-slate-600 border-slate-200"}};return V?e.jsx(y,{children:e.jsxs("div",{className:"max-w-6xl mx-auto p-12 text-center mt-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-500 mt-6 font-black uppercase tracking-[0.3em] animate-pulse",children:"Sincronizando Orden..."})]})}):_?e.jsx(y,{children:e.jsx("div",{className:"max-w-3xl mx-auto p-12 mt-10",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-8 rounded-2xl shadow-sm flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(ne,{size:48,className:"text-red-500"}),e.jsxs("div",{children:[e.jsx("strong",{className:"font-black text-xl block mb-2 uppercase tracking-tighter",children:"Error del Servidor"}),e.jsx("span",{className:"text-base font-bold text-red-600 bg-white px-4 py-2 rounded-lg border border-red-100 shadow-inner block",children:_})]})]})})}):s?e.jsxs(y,{children:[e.jsx(re,{title:`Orden ${s.numero_orden}`}),e.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 bg-white p-6 rounded-3xl shadow-xl border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-200",children:e.jsx(k,{size:32})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-900 tracking-tighter italic",children:["#",s.numero_orden]}),e.jsx("span",{className:`px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border-2 ${se(s.estado)}`,children:s.estado})]}),e.jsxs("p",{className:"text-slate-500 font-bold uppercase text-xs mt-1",children:[($=s.cliente)==null?void 0:$.razon_social," • Contacto: ID ",s.contacto_id]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.estado==="Confirmada"&&e.jsxs("button",{onClick:W,className:"px-6 py-3 bg-green-600 text-white rounded-2xl font-black text-xs hover:bg-green-700 flex items-center gap-2 shadow-xl shadow-green-100 transition-all active:scale-95",children:[e.jsx(k,{size:18})," GENERAR FACTURA"]}),e.jsxs("div",{className:"flex items-center gap-2 px-5 py-3 bg-slate-900 text-white rounded-2xl shadow-xl",children:[e.jsx(F,{size:18,className:"text-blue-400"}),e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest",children:["Diseño: ",s.estado_diseno]})]}),s.diseno_cobro_aprobado&&e.jsxs("div",{className:"flex items-center gap-2 px-5 py-3 bg-indigo-600 text-white rounded-2xl shadow-xl animate-pulse",children:[e.jsx(ie,{size:18}),e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-widest",children:["Cobro Activo: ",Math.floor(s.diseno_minutos_acumulados/60),"h ",s.diseno_minutos_acumulados%60,"m • ",p(s.diseno_monto_calculado)]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"bg-slate-900 rounded-[2.5rem] p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-blue-600/10 rounded-full -mr-32 -mt-32 blur-3xl"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-8",children:[e.jsxs("div",{className:"space-y-4 flex-1 w-full",children:[e.jsxs("h3",{className:"text-blue-400 font-black uppercase tracking-[0.2em] text-xs flex items-center gap-2",children:[e.jsx(oe,{size:16})," Gestión de Procesos y Diseño"]}),e.jsx("div",{className:"flex flex-wrap gap-4",children:m?e.jsxs("div",{className:"w-full h-32 bg-blue-600 rounded-[2rem] flex items-center justify-between px-10 shadow-inner relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-6 z-10",children:[e.jsx("div",{className:"w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center animate-spin-slow",children:e.jsx(f,{size:32})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-[10px] font-black uppercase tracking-[0.3em] opacity-80",children:["PROCESANDO: ",m.fase]}),e.jsx("div",{className:"text-4xl font-mono font-black tabular-nums",children:te(B)})]})]}),e.jsx("button",{onClick:()=>g("stop",m.fase),className:"w-16 h-16 bg-white text-blue-600 rounded-full flex items-center justify-center hover:bg-red-50 hover:text-red-600 transition-all active:scale-90 z-10 shadow-2xl",children:e.jsx(xe,{fill:"currentColor",size:24})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-[shimmer_2s_infinite]"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>g("start","Diseño"),disabled:["Diseño Aprobado","En Impresión","En Producción","Entregado"].includes(s.estado),className:`flex-1 min-w-[180px] h-20 rounded-3xl flex items-center justify-center gap-4 transition-all active:scale-95 shadow-lg group ${["Diseño Aprobado","En Impresión","En Producción","Entregado"].includes(s.estado)?"bg-slate-800 opacity-50":"bg-blue-600 hover:bg-blue-500 shadow-blue-900/40"}`,children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform",children:e.jsx(ce,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest opacity-60",children:"Fase 1"}),e.jsx("div",{className:"font-black text-sm",children:"ENVIAR A DISEÑO"})]})]}),e.jsxs("button",{onClick:()=>g("start","Impresión"),disabled:["En Impresión","En Producción","Entregado"].includes(s.estado),className:`flex-1 min-w-[180px] h-20 rounded-3xl flex items-center justify-center gap-4 transition-all active:scale-95 border group ${["En Impresión","En Producción","Entregado"].includes(s.estado)?"bg-slate-800 border-slate-700 opacity-50":"bg-slate-800 hover:bg-slate-700 border-slate-700 shadow-lg"}`,children:[e.jsx(de,{fill:"currentColor",size:20,className:"text-slate-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest opacity-60",children:"Fase 2"}),e.jsx("div",{className:"font-black text-sm",children:"ENVIAR A IMPRESIÓN"})]})]}),e.jsxs("button",{onClick:()=>g("start","Producción"),disabled:["En Producción","Entregado"].includes(s.estado),className:`flex-1 min-w-[180px] h-20 rounded-3xl flex items-center justify-center gap-4 transition-all active:scale-95 border group ${["En Producción","Entregado"].includes(s.estado)?"bg-slate-800 border-slate-700 opacity-50":"bg-indigo-900 hover:bg-indigo-800 border-indigo-700 shadow-lg"}`,children:[e.jsx(F,{size:20,className:"text-indigo-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest opacity-60",children:"Fase 3"}),e.jsx("div",{className:"font-black text-sm",children:"ENVIAR A MÁQUINA"})]})]}),e.jsx("button",{onClick:J,className:"flex-none w-20 h-20 bg-red-900/30 hover:bg-red-900/50 border border-red-900/50 rounded-3xl flex items-center justify-center transition-all active:scale-95 group shadow-xl",title:"Reimprimir / Reproceso",children:e.jsx(q,{size:24,className:"text-red-500 group-hover:rotate-180 transition-transform duration-500"})})]})})]}),s.estado_diseno!=="Aprobado"&&e.jsxs("div",{className:"w-full md:w-80 bg-white/5 border border-white/10 p-6 rounded-[2rem] space-y-4 backdrop-blur-sm",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-blue-300",children:"Entregar Diseño"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"file",id:"design-file",hidden:!0,onChange:t=>R("imagen",t.target.files[0])}),e.jsxs("label",{htmlFor:"design-file",className:`w-full h-12 rounded-xl border-2 border-dashed border-white/20 flex items-center justify-center gap-2 text-[10px] font-black uppercase cursor-pointer transition-all ${d.imagen?"bg-green-500/20 border-green-500/50 text-green-300":"hover:bg-white/10"}`,children:[e.jsx(pe,{size:14})," ",d.imagen?"IMAGEN LISTA":"SELECCIONAR ARCHIVO"]}),e.jsx("textarea",{value:d.comentarios,onChange:t=>R("comentarios",t.target.value),placeholder:"Comentarios para el cliente...",className:"w-full bg-white/5 border-white/10 rounded-xl text-[11px] font-bold text-white placeholder:text-white/20 h-16 resize-none focus:ring-blue-500"}),e.jsx("button",{onClick:K,disabled:z||!d.imagen,className:"w-full h-12 bg-blue-600 hover:bg-blue-500 disabled:opacity-30 rounded-xl font-black text-[10px] uppercase shadow-lg shadow-blue-900 transition-all",children:z?"SUBIENDO...":"SUBIR Y NOTIFICAR CLIENTE"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-xl border border-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"p-8 border-b border-slate-50 flex justify-between items-center bg-slate-50/50",children:[e.jsxs("h3",{className:"text-sm font-black uppercase tracking-widest text-slate-500 flex items-center gap-3",children:[e.jsx(k,{size:18,className:"text-blue-500"})," Detalle de la Orden"]}),e.jsxs("div",{className:"text-xs font-bold text-slate-400 bg-white px-4 py-2 rounded-2xl border border-slate-100 italic",children:["Documento ID: ",s.id]})]}),e.jsx("div",{className:"p-0 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/50",children:[e.jsx("th",{className:"px-8 py-5 text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Producto / Servicio"}),e.jsx("th",{className:"px-8 py-5 text-center text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Cant."}),e.jsx("th",{className:"px-8 py-5 text-right text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Precio"}),e.jsx("th",{className:"px-8 py-5 text-right text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:(M=s.detalles)==null?void 0:M.map(t=>{var a,r,l;return e.jsxs("tr",{className:"group hover:bg-blue-50/30 transition-all",children:[e.jsxs("td",{className:"px-8 py-6",children:[e.jsx("div",{className:"font-black text-slate-800 text-base",children:(a=t.item)==null?void 0:a.nombre}),e.jsxs("div",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-0.5",children:["Categoría: ",((l=(r=t.item)==null?void 0:r.categoria)==null?void 0:l.nombre)||"General"]})]}),e.jsx("td",{className:"px-8 py-6 text-center",children:e.jsx("span",{className:"bg-slate-100 text-slate-900 px-4 py-2 rounded-xl font-black text-sm",children:t.cantidad})}),e.jsx("td",{className:"px-8 py-6 text-right font-bold text-slate-400 italic",children:p(t.precio_unitario)}),e.jsx("td",{className:"px-8 py-6 text-right font-black text-slate-900 text-lg group-hover:text-blue-600 transition-colors",children:p(t.total)})]},t.id)})})]})}),e.jsx("div",{className:"p-10 bg-slate-50 border-t border-slate-100",children:e.jsxs("div",{className:"flex flex-col gap-3 max-w-xs ml-auto",children:[e.jsxs("div",{className:"flex justify-between items-center text-slate-500 font-bold uppercase text-[10px] tracking-widest",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"text-slate-800 text-sm tracking-normal",children:p(s.subtotal)})]}),e.jsxs("div",{className:"flex justify-between items-center text-slate-500 font-bold uppercase text-[10px] tracking-widest",children:[e.jsx("span",{children:"Impuestos (7%)"}),e.jsx("span",{className:"text-slate-800 text-sm tracking-normal",children:p(s.itbms_total)})]}),e.jsx("div",{className:"h-px bg-slate-200 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-black uppercase tracking-[0.2em] text-blue-600",children:"Total Final"}),e.jsx("span",{className:"text-3xl font-black text-slate-900 tracking-tighter italic",children:p(s.total)})]})]})})]}),h.length>0&&e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-xl border border-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"p-8 bg-white border-b border-slate-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-sm font-black uppercase tracking-widest text-slate-500 flex items-center gap-3",children:[e.jsx(q,{size:18,className:"text-purple-500"})," Trazabilidad de Revisiones"]}),e.jsxs("span",{className:"bg-purple-50 text-purple-700 px-4 py-1.5 rounded-full text-[10px] font-black uppercase ring-1 ring-purple-100",children:[h.length," Entregas realizadas"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-8",children:[...h].reverse().map((t,a)=>e.jsxs("div",{className:"bg-white border border-slate-100 rounded-3xl p-5 shadow-sm hover:shadow-xl transition-all hover:scale-[1.02] relative group",children:[e.jsxs("div",{className:"absolute -top-3 -left-3 w-8 h-8 bg-slate-900 text-white rounded-full flex items-center justify-center font-black text-[10px] shadow-lg group-hover:bg-blue-600 transition-colors",children:["#",h.length-a]}),e.jsx("img",{src:`/storage/${t.imagen}`,className:"w-full h-40 object-cover rounded-2xl mb-4 shadow-inner ring-1 ring-slate-100 cursor-zoom-in",onClick:()=>window.open(`/storage/${t.imagen}`,"_blank")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-[9px] font-black uppercase ${t.estado==="Aprobado"?"bg-green-100 text-green-700":t.estado==="Rechazado"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:t.estado}),e.jsxs("span",{className:"text-[9px] font-black text-slate-300 uppercase italic",children:["REV #",t.intento]})]}),e.jsx("p",{className:"text-[11px] font-bold text-slate-600 line-clamp-3 italic leading-relaxed",children:t.comentarios_cliente||t.comentarios_staff||"Sin comentarios"}),e.jsxs("div",{className:"text-[9px] text-slate-400 font-bold pt-2 border-t border-slate-50 flex items-center gap-1.5",children:[e.jsx(f,{size:10})," ",new Date(t.created_at).toLocaleString()]})]})]},t.id))})]})]}),e.jsx("div",{className:"lg:col-span-4 lg:sticky lg:top-8 self-start h-[calc(100vh-4rem)]",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl border border-slate-100 flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b bg-slate-900 text-white flex items-center justify-between shadow-lg",children:[e.jsxs("h3",{className:"font-black text-xs uppercase tracking-[0.2em] flex items-center gap-3",children:[e.jsx(L,{size:20,className:"text-blue-400"})," Chat Operativo"]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-500/10 rounded-full ring-1 ring-green-500/20",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)]"}),e.jsx("span",{className:"text-[10px] font-black text-green-400 tracking-tighter",children:"CLIENTE ONLINE"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-slate-50/30",children:[w.length===0&&e.jsxs("div",{className:"text-center py-32 opacity-10",children:[e.jsx(L,{size:64,className:"mx-auto mb-4"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-[0.4em]",children:"Inicia la conversación"})]}),w.map((t,a)=>e.jsx("div",{className:`flex ${t.emisor==="staff"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:"max-w-[85%] group",children:e.jsxs("div",{className:`p-4 rounded-3xl shadow-sm relative ${t.emisor==="staff"?"bg-blue-600 text-white rounded-tr-none":"bg-white text-slate-800 border border-slate-200 rounded-tl-none shadow-slate-200/50"}`,children:[e.jsx("p",{className:"text-xs font-bold leading-relaxed",children:t.texto}),t.requiere_aprobacion&&e.jsxs("div",{className:"mt-3 py-2 px-3 bg-yellow-400 text-yellow-950 text-[9px] font-black rounded-xl uppercase flex items-center gap-2 shadow-inner",children:[e.jsx(f,{size:12,className:"animate-pulse"})," PENDIENTE DE APROBACIÓN"]}),e.jsxs("div",{className:`text-[8px] mt-2 opacity-60 font-black italic flex items-center gap-1 ${t.emisor==="staff"?"justify-end":"justify-start"}`,children:[e.jsx(f,{size:8})," ",new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})})},a)),e.jsx("div",{ref:I})]}),e.jsxs("form",{onSubmit:Z,className:"p-6 border-t bg-white space-y-4 shadow-inner",children:[e.jsx("textarea",{value:x.mensaje_texto,onChange:t=>P("mensaje_texto",t.target.value),placeholder:"Escribe aquí tu mensaje externo...",className:"w-full border-2 border-slate-100 rounded-3xl text-sm font-bold focus:ring-0 focus:border-blue-500 h-28 bg-slate-50/50 p-5 shadow-inner placeholder:text-slate-300 transition-all"}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3 text-[10px] font-black text-slate-400 cursor-pointer hover:text-blue-600 transition-colors uppercase tracking-widest leading-none",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:x.requiere_aprobacion,onChange:t=>P("requiere_aprobacion",t.target.checked),className:"peer appearance-none w-5 h-5 border-2 border-slate-200 rounded-lg checked:bg-blue-600 checked:border-blue-600 transition-all cursor-pointer"}),e.jsx(me,{size:12,className:"absolute top-1 left-1 text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity"})]}),"Pedir Aprobación"]}),e.jsxs("button",{type:"submit",disabled:!x.mensaje_texto||Q,className:"bg-blue-600 text-white px-8 py-4 rounded-2xl font-black text-xs flex items-center gap-3 disabled:opacity-20 hover:bg-blue-700 transition-all hover:scale-105 active:scale-95 shadow-xl shadow-blue-100",children:[e.jsx(ue,{size:16})," ENVIAR"]})]})]})]})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-700 to-indigo-800 rounded-[2.5rem] p-8 text-white flex flex-col md:flex-row justify-between items-center gap-8 shadow-2xl",children:[e.jsxs("div",{className:"space-y-3 text-center md:text-left",children:[e.jsxs("h3",{className:"font-black text-2xl flex items-center justify-center md:justify-start gap-4 uppercase tracking-tighter italic",children:[e.jsx(je,{size:28,className:"text-blue-300"})," Link de Seguimiento"]}),e.jsx("p",{className:"text-blue-100/60 text-xs font-bold uppercase tracking-[0.2em]",children:"Enlace público para que el cliente apruebe diseños y revise su pedido."})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-white/10 p-2 rounded-3xl border border-white/10 backdrop-blur-md",children:[e.jsxs("div",{className:"px-5 font-mono text-sm opacity-60 text-blue-200 hidden sm:block",children:["...",(T=s.tracking_token)==null?void 0:T.substring(0,12),"..."]}),e.jsxs("button",{onClick:ee,className:"bg-white text-blue-900 px-10 py-5 rounded-2xl font-black text-sm hover:bg-blue-50 flex items-center gap-3 transition-all active:scale-95 shadow-2xl",children:[e.jsx(ge,{size:20})," COPIAR ENLACE PRIVADO"]})]})]})]}),e.jsx("style",{children:`
                @keyframes shimmer {
                    100% { transform: translateX(100%); }
                }
                .animate-spin-slow {
                    animation: spin 8s linear infinite;
                }
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `})]}):null}export{Oe as default};
