import{r as c,u as q,j as e,H as E,a as g}from"./app-3DoqhR_o.js";import{A as f}from"./AuthenticatedLayout-314zbiSn.js";import{c as r}from"./createLucideIcon-BNyQ3YPG.js";import{C as $}from"./cpu-BQVK-63c.js";import{F as D}from"./file-text-BdjYmdA0.js";import{C as M}from"./circle-check-big-LPXb57_K.js";import{S as P}from"./send-Bx1LnruW.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],R=r("activity",L);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],j=r("clock",T);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],I=r("copy",F);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],U=r("external-link",H);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],N=r("message-square",O);function Y({ordenId:o}){var d,x,p,m,h;const[s,y]=c.useState(null),[w,v]=c.useState(!0),{data:l,setData:i,post:V,processing:k,reset:_}=q({mensaje_texto:"",requiere_aprobacion:!1,archivo:null}),n=()=>{fetch(`/api/ventas/ordenes/${o}`).then(t=>t.json()).then(t=>{y(t),v(!1)}).catch(t=>console.error("Error al cargar orden:",t))};c.useEffect(()=>{n();const t=setInterval(n,3e4);return()=>clearInterval(t)},[o]);const C=()=>{confirm("¿Desea generar la factura fiscal a partir de esta orden?")&&g.post(route("facturas.convertir",s.id))},z=t=>{t.preventDefault(),g.post(route("tracking.mensaje",s.tracking_token),{...l,emisor:"staff"},{onSuccess:()=>{_(),n()}})},A=()=>{const t=`${window.location.origin}/tracking/${s.tracking_token}`;navigator.clipboard.writeText(t),alert("Enlace de seguimiento copiado al portapapeles")},S=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t);if(w)return e.jsx(f,{children:e.jsxs("div",{className:"max-w-6xl mx-auto p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4 font-bold",children:"Sincronizando con Planta de Producción..."})]})});const a=((d=s.produccion)==null?void 0:d[0])||null;return e.jsxs(f,{children:[e.jsx(E,{title:`Orden ${s.numero_orden}`}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-2 shadow-sm border border-slate-200 flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-xl",children:[e.jsx(R,{size:18,className:"text-blue-600"}),e.jsx("span",{className:"text-xs font-black uppercase text-slate-700",children:"Estado Real:"}),e.jsx("span",{className:`text-xs font-black px-2 py-1 rounded-lg ${(a==null?void 0:a.estado)==="Terminado"?"bg-green-500 text-white":"bg-blue-500 text-white animate-pulse"}`,children:a?a.estado:"En Pre-Prensa"})]}),(a==null?void 0:a.maquina)&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-l border-slate-200",children:[e.jsx($,{size:18,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-tighter",children:"Máquina actual:"}),e.jsx("span",{className:"text-xs font-black text-slate-800",children:a.maquina.nombre})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 bg-slate-50 border-b border-slate-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-slate-900 tracking-tighter italic",children:["#",s.numero_orden]}),e.jsx("p",{className:"text-sm font-bold text-slate-500 uppercase",children:(x=s.cliente)==null?void 0:x.razon_social})]}),e.jsxs("div",{className:"flex gap-2",children:[s.estado==="Confirmada"&&e.jsxs("button",{onClick:C,className:"px-4 py-2 bg-green-600 text-white rounded-xl font-black text-xs hover:bg-green-700 flex items-center gap-2 shadow-lg shadow-green-100 transition-all",children:[e.jsx(D,{size:16})," FACTURAR"]}),e.jsxs("span",{className:`px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 ${s.estado_diseno==="Aprobado"?"bg-green-100 text-green-700 border border-green-200":"bg-yellow-100 text-yellow-700 border border-yellow-200"}`,children:[s.estado_diseno==="Aprobado"?e.jsx(M,{size:14}):e.jsx(j,{size:14}),"Diseño: ",s.estado_diseno]})]})]}),e.jsx("div",{className:"p-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-4 text-left text-[10px] font-black uppercase text-slate-400",children:"Descripción del Producto"}),e.jsx("th",{className:"pb-4 text-center text-[10px] font-black uppercase text-slate-400",children:"Cant."}),e.jsx("th",{className:"pb-4 text-right text-[10px] font-black uppercase text-slate-400",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:(p=s.detalles)==null?void 0:p.map(t=>{var u,b;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsxs("td",{className:"py-4",children:[e.jsx("div",{className:"font-bold text-slate-800",children:(u=t.item)==null?void 0:u.nombre}),e.jsxs("div",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-tighter",children:["SKU: ",(b=t.item)==null?void 0:b.codigo]})]}),e.jsx("td",{className:"py-4 text-center font-black text-slate-600",children:t.cantidad}),e.jsx("td",{className:"py-4 text-right font-black text-slate-900",children:S(t.total)})]},t.id)})})]})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl p-6 text-white flex justify-between items-center shadow-xl shadow-blue-100",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-black text-lg flex items-center gap-2 uppercase tracking-tighter",children:[e.jsx(U,{size:20})," Portal del Cliente"]}),e.jsx("p",{className:"text-blue-100 text-xs font-bold opacity-80",children:"Usa este enlace para que el cliente apruebe diseños desde su móvil."})]}),e.jsxs("button",{onClick:A,className:"bg-white text-blue-600 px-6 py-3 rounded-xl font-black text-xs hover:bg-blue-50 flex items-center gap-2 transition-all active:scale-95 shadow-lg",children:[e.jsx(I,{size:16})," COPIAR LINK"]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col h-[700px]",children:[e.jsxs("div",{className:"p-4 border-b bg-slate-50 rounded-t-2xl flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-slate-800 flex items-center gap-2 uppercase text-xs tracking-widest",children:[e.jsx(N,{size:18,className:"text-blue-500"})," Chat de Diseño"]}),e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50",children:[((m=s.mensajes)==null?void 0:m.length)===0&&e.jsxs("div",{className:"text-center py-20 opacity-30",children:[e.jsx(N,{size:40,className:"mx-auto mb-2 text-slate-400"}),e.jsx("p",{className:"text-xs font-bold",children:"Sin mensajes aún"})]}),(h=s.mensajes)==null?void 0:h.map(t=>e.jsx("div",{className:`flex ${t.emisor==="staff"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[90%] p-4 rounded-2xl shadow-sm ${t.emisor==="staff"?"bg-blue-600 text-white rounded-tr-none":"bg-white text-slate-800 border border-slate-200 rounded-tl-none"}`,children:[e.jsx("p",{className:"text-xs font-bold leading-relaxed",children:t.mensaje_texto}),t.requiere_aprobacion&&e.jsxs("div",{className:"mt-3 py-1.5 px-3 bg-yellow-400 text-yellow-950 text-[9px] font-black rounded-lg uppercase flex items-center gap-2 shadow-inner",children:[e.jsx(j,{size:12})," PENDIENTE DE APROBACIÓN"]}),e.jsx("div",{className:"text-[9px] mt-2 opacity-60 text-right font-black italic",children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},t.id))]}),e.jsxs("form",{onSubmit:z,className:"p-4 border-t bg-white rounded-b-2xl space-y-3",children:[e.jsx("textarea",{value:l.mensaje_texto,onChange:t=>i("mensaje_texto",t.target.value),placeholder:"Instrucciones de diseño o mensaje al cliente...",className:"w-full border-slate-200 rounded-xl text-xs font-bold focus:ring-blue-500 h-24 bg-slate-50 border-none shadow-inner p-3"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 text-[10px] font-black text-slate-500 cursor-pointer hover:text-blue-600 transition-colors uppercase tracking-tighter",children:[e.jsx("input",{type:"checkbox",checked:l.requiere_aprobacion,onChange:t=>i("requiere_aprobacion",t.target.checked),className:"rounded text-blue-600 border-slate-300"}),"¿Marcar para Aprobación?"]}),e.jsxs("button",{disabled:k||!l.mensaje_texto,className:"bg-blue-600 text-white px-6 py-2.5 rounded-xl font-black text-xs flex items-center gap-2 disabled:opacity-50 shadow-lg shadow-blue-100 hover:scale-105 transition-transform",children:[e.jsx(P,{size:14})," ENVIAR"]})]})]})]})})]})]})]})}export{Y as default};
