import{r,R as _,b as I,u as b,j as e,H as M}from"./app-BqyPfEI0.js";import{A as z}from"./AuthenticatedLayout-ChjIDkpR.js";import{L}from"./layers-CtqXcCOg.js";import{P as D}from"./plus-De02fmEl.js";import{P as O}from"./printer-BPgBlIsO.js";import{C as R}from"./circle-check-big-BP_FBiHy.js";import"./createLucideIcon-DrM2Vc-y.js";function F({pendientes:i,pliegos:p,papeles:d}){const[a,n]=r.useState([]),[f,l]=r.useState(!1),[j,c]=r.useState(null);_.useEffect(()=>{const s=window.Echo.channel("orders");return s.listen("OrderStateChanged",t=>{I.reload({only:["pendientes","pliegos"]})}),()=>s.stopListening("OrderStateChanged")},[]);const{data:g,setData:o,post:N,processing:v,reset:w}=b({item_id:"",ordenes:[]}),{data:x,setData:m,post:y,processing:u,reset:h}=b({material_id:"",cantidad_utilizada:""}),S=s=>{const t=a.includes(s)?a.filter(E=>E!==s):[...a,s];n(t),o("ordenes",t)},k=s=>{s.preventDefault(),N(route("produccion.pliegos.store"),{onSuccess:()=>{n([]),w()}})},C=s=>{c(s),l(!0)},P=s=>{s.preventDefault(),y(route("produccion.pliegos.imprimir",j.id),{onSuccess:()=>{l(!1),h(),c(null)}})};return e.jsxs(z,{children:[e.jsx(M,{title:"Gestión de Pliegos (Nesting)"}),e.jsx("div",{className:"max-w-7xl mx-auto p-6 space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-50 border-b flex justify-between items-center",children:[e.jsxs("h2",{className:"font-black text-slate-800 flex items-center gap-2",children:[e.jsx(L,{size:20})," ÓRDENES EN COLA DE IMPRESIÓN"]}),e.jsxs("span",{className:"bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-bold",children:[i.length," Pendientes"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 uppercase text-[10px] font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-left",children:"Selección"}),e.jsx("th",{className:"p-4 text-left",children:"Orden / Cliente"}),e.jsx("th",{className:"p-4 text-left",children:"Producto"}),e.jsx("th",{className:"p-4 text-center",children:"Cant."})]})}),e.jsx("tbody",{className:"divide-y",children:i.map(s=>{var t;return e.jsxs("tr",{className:a.includes(s.id)?"bg-blue-50":"",children:[e.jsx("td",{className:"p-4 text-center",children:e.jsx("input",{type:"checkbox",checked:a.includes(s.id),onChange:()=>S(s.id),className:"rounded border-slate-300 text-blue-600 w-5 h-5"})}),e.jsxs("td",{className:"p-4",children:[e.jsxs("div",{className:"font-bold",children:["#",s.venta.numero_orden]}),e.jsx("div",{className:"text-slate-400 text-xs",children:s.venta.cliente.razon_social})]}),e.jsx("td",{className:"p-4 font-medium uppercase",children:(t=s.materia_prima)==null?void 0:t.nombre}),e.jsx("td",{className:"p-4 text-center font-bold",children:s.cantidad})]},s.id)})})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg border-2 border-blue-100",children:[e.jsxs("h3",{className:"font-black text-slate-900 mb-4 flex items-center gap-2 text-lg uppercase",children:[e.jsx(D,{size:24,className:"text-blue-600"})," Armar Nuevo Pliego"]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Tipo de Papel / Soporte"}),e.jsxs("select",{className:"w-full border-slate-200 rounded-xl font-bold",value:g.item_id,onChange:s=>o("item_id",s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Seleccione material..."}),d.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]})]}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-xl",children:e.jsxs("p",{className:"text-blue-700 font-bold text-sm",children:["Órdenes seleccionadas: ",a.length]})}),e.jsx("button",{disabled:v||a.length===0,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-xl shadow-lg shadow-blue-100 disabled:opacity-50",children:"CREAR PLIEGO [NESTING]"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-slate-900 text-white flex justify-between items-center",children:e.jsxs("h2",{className:"font-bold flex items-center gap-2",children:[e.jsx(O,{size:18})," ÚLTIMOS PLIEGOS"]})}),e.jsx("div",{className:"divide-y",children:p.map(s=>{var t;return e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("span",{className:"font-black text-slate-800",children:["PLIEGO #",s.id]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-black uppercase ${s.estado==="Impreso"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:s.estado})]}),e.jsx("p",{className:"text-xs text-slate-500 font-bold uppercase",children:(t=s.materia_prima)==null?void 0:t.nombre}),s.estado==="Pendiente"&&e.jsxs("button",{onClick:()=>C(s),className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-bold text-xs flex items-center justify-center gap-2 uppercase tracking-tighter",children:[e.jsx(R,{size:14})," Marcar como Impreso"]})]},s.id)})})]})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"font-black text-xl text-slate-900 mb-4",children:"Registrar Material Utilizado"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Material / Insumo"}),e.jsxs("select",{className:"w-full border-slate-200 rounded-xl font-bold",value:x.material_id,onChange:s=>m("material_id",s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Seleccione material..."}),d.map(s=>e.jsxs("option",{value:s.id,children:[s.nombre," (Stock: ",s.stock_actual,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Cantidad Utilizada"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",className:"w-full border-slate-200 rounded-xl font-bold",value:x.cantidad_utilizada,onChange:s=>m("cantidad_utilizada",s.target.value),required:!0,placeholder:"Ej: 10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{l(!1),h()},className:"flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 rounded-xl",children:"Cancelar"}),e.jsx("button",{disabled:u,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl disabled:opacity-50",children:u?"Procesando...":"Confirmar"})]})]})]})})]})}export{F as default};
