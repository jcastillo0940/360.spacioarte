import{r as i,u as R,P as se,j as e,H as ae,b,a as P}from"./app-C7fXC9xy.js";import{A as w}from"./AuthenticatedLayout-DSgvOGZX.js";import{C as M}from"./circle-alert-ChTw9Z6N.js";import{F as g}from"./file-text-BMeWe_Rp.js";import{c as f}from"./createLucideIcon-Br14Htuj.js";import{C as O}from"./cpu-Cm_uxrXp.js";import{U as F}from"./upload-DAI_Px--.js";import{C as T}from"./circle-check-big-BiQR7bSr.js";import{C as v}from"./clock-Ad6sujdi.js";import{M as L}from"./message-square-WJERyVEd.js";import{S as re}from"./send-BrrXaSGO.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ie=f("activity",le);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],oe=f("copy",ne);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],q=f("external-link",ce);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],U=f("history",de);function _e({ordenId:d}){var $,A,I;const[s,B]=i.useState(null),[V,N]=i.useState(!0),[k,y]=i.useState(null),[j,_]=i.useState([]),[h,H]=i.useState([]),[C,E]=i.useState(!1),S=i.useRef(null),{data:n,setData:z,post:xe,processing:pe,reset:G}=R({imagen:null,comentarios:""}),{data:o,setData:D,processing:Q,reset:W}=R({mensaje_texto:"",requiere_aprobacion:!1}),X=()=>{var t;(t=S.current)==null||t.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{X()},[j]);const u=()=>{b.get(`/api/ventas/ordenes/${d}`).then(t=>{t.data.error?y(t.data.error):(B(t.data),b.get(`/api/ventas/ordenes/${d}/historial`).then(a=>H(a.data)).catch(a=>console.error("Error al cargar historial:",a))),N(!1)}).catch(t=>{var a,r;console.error("Error al cargar orden:",t),y(((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.error)||"Error de conexión al cargar la orden."),N(!1)})};i.useEffect(()=>{u()},[d]),i.useEffect(()=>{if(!(s!=null&&s.tracking_token))return;const t=new se("cbd8be0eaf6853d5161c",{cluster:"mt1",forceTLS:!0,enabledTransports:["ws","wss"]});return t.subscribe(`chat.${s.tracking_token}`).bind("nuevo-mensaje",function(r){const l=r.mensaje||r;_(p=>p.some(m=>m.id&&m.id===l.id||m.texto===l.texto&&m.created_at===l.created_at&&m.emisor===l.emisor)?p:[...p,l])}),()=>{t.unsubscribe(`chat.${s.tracking_token}`),t.disconnect()}},[s==null?void 0:s.tracking_token]);const c=async t=>{confirm(`¿Cambiar estado a ${t}?`)&&P.put(`/ventas/ordenes/${d}/estado`,{estado:t},{preserveScroll:!0,onSuccess:()=>u()})},Y=async()=>{if(confirm("¿Desea enviar esta orden a RE-IMPRESIÓN? Esto creará nuevas tareas en producción."))try{await b.post(`/api/ventas/ordenes/${d}/reimprimir`),alert("Orden enviada a re-impresión"),u()}catch{alert("Error al generar re-impresión")}},J=async t=>{var r,l;if(t.preventDefault(),!n.imagen)return alert("Seleccione una imagen");const a=new FormData;a.append("imagen",n.imagen),a.append("comentarios",n.comentarios),a.append("numero_orden",s.numero_orden),E(!0);try{await b.post("/api/diseno/upload",a,{headers:{"Content-Type":"multipart/form-data"}}),G(),alert("Diseño subido correctamente"),u()}catch(p){alert("Error: "+(((l=(r=p.response)==null?void 0:r.data)==null?void 0:l.error)||"Falla al subir"))}finally{E(!1)}},K=()=>{confirm("¿Desea generar la factura fiscal?")&&P.post(route("facturas.convertir",s.id))},Z=async t=>{if(t.preventDefault(),!o.mensaje_texto)return;const a={id:Date.now(),texto:o.mensaje_texto,emisor:"staff",created_at:new Date().toISOString(),requiere_aprobacion:o.requiere_aprobacion};_(r=>[...r,a]);try{await b.post("/api/ventas/enviar-chat",{mensaje:a,token:s.tracking_token}),W("mensaje_texto","requiere_aprobacion")}catch(r){console.error("Falla al enviar mensaje:",r)}},ee=()=>{if(!(s!=null&&s.tracking_token)){alert("No hay token de seguimiento generado para esta orden.");return}const t=`${window.location.origin}/tracking/${s.tracking_token}`;navigator.clipboard.writeText(t),alert("Enlace de seguimiento copiado")},x=t=>t==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),te=t=>{switch(t){case"Borrador":return"bg-slate-100 text-slate-600 border-slate-200";case"Confirmada":return"bg-blue-100 text-blue-700 border-blue-200";case"Diseño":return"bg-purple-100 text-purple-700 border-purple-200";case"Pre-Prensa":return"bg-cyan-100 text-cyan-700 border-cyan-200";case"Producción":return"bg-indigo-100 text-indigo-700 border-indigo-200";case"Terminado":return"bg-green-100 text-green-700 border-green-200";case"Entregado":return"bg-emerald-600 text-white border-emerald-700 shadow-lg shadow-emerald-100";case"Facturada":return"bg-slate-900 text-white border-slate-800";case"Cancelada":return"bg-red-100 text-red-700 border-red-200";default:return"bg-slate-100 text-slate-600 border-slate-200"}};return V?e.jsx(w,{children:e.jsxs("div",{className:"max-w-6xl mx-auto p-12 text-center mt-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-500 mt-6 font-black uppercase tracking-[0.3em] animate-pulse",children:"Sincronizando Orden..."})]})}):k?e.jsx(w,{children:e.jsx("div",{className:"max-w-3xl mx-auto p-12 mt-10",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-8 rounded-2xl shadow-sm flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx(M,{size:48,className:"text-red-500"}),e.jsxs("div",{children:[e.jsx("strong",{className:"font-black text-xl block mb-2 uppercase tracking-tighter",children:"Error del Servidor"}),e.jsx("span",{className:"text-base font-bold text-red-600 bg-white px-4 py-2 rounded-lg border border-red-100 shadow-inner block",children:k})]})]})})}):s?e.jsxs(w,{children:[e.jsx(ae,{title:`Orden ${s.numero_orden}`}),e.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 bg-white p-6 rounded-3xl shadow-xl border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-200",children:e.jsx(g,{size:32})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-900 tracking-tighter italic",children:["#",s.numero_orden]}),e.jsx("span",{className:`px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border-2 ${te(s.estado)}`,children:s.estado})]}),e.jsxs("p",{className:"text-slate-500 font-bold uppercase text-xs mt-1",children:[($=s.cliente)==null?void 0:$.razon_social," • Contacto: ID ",s.contacto_id]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.estado==="Confirmada"&&e.jsxs("button",{onClick:K,className:"px-6 py-3 bg-green-600 text-white rounded-2xl font-black text-xs hover:bg-green-700 flex items-center gap-2 shadow-xl shadow-green-100 transition-all active:scale-95",children:[e.jsx(g,{size:18})," GENERAR FACTURA"]}),e.jsxs("select",{value:s.estado,onChange:t=>c(t.target.value),className:"px-6 py-3 bg-slate-900 text-white rounded-2xl shadow-xl border-0 font-black text-[10px] uppercase tracking-widest cursor-pointer hover:bg-black transition-colors",children:[e.jsx("option",{value:"Borrador",children:"Borrador"}),e.jsx("option",{value:"Confirmada",children:"Confirmada"}),e.jsx("option",{value:"Diseño",children:"Fase 1: Diseño"}),e.jsx("option",{value:"Pre-Prensa",children:"Fase 2: Impresión"}),e.jsx("option",{value:"Producción",children:"Fase 3: Máquinas"}),e.jsx("option",{value:"Terminado",children:"Fase 4: Bodega"}),e.jsx("option",{value:"Entregado",children:"Fase 5: Entregado"}),e.jsx("option",{value:"Facturada",children:"Facturada"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"bg-slate-900 rounded-[2.5rem] p-8 text-white shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-blue-600/10 rounded-full -mr-32 -mt-32 blur-3xl"}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-8",children:[e.jsxs("div",{className:"space-y-6 flex-1 w-full",children:[e.jsxs("h3",{className:"text-blue-400 font-black uppercase tracking-[0.2em] text-xs flex items-center gap-2",children:[e.jsx(ie,{size:16})," Flujo de Trabajo Producción"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>c("Diseño"),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center justify-center gap-2 ${s.estado==="Diseño"?"bg-blue-600 border-blue-400 shadow-lg shadow-blue-900/40 text-white":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-500"}`,children:[e.jsx(O,{size:24}),e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest",children:"DISEÑO"})]}),e.jsxs("button",{onClick:()=>c("Pre-Prensa"),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center justify-center gap-2 ${s.estado==="Pre-Prensa"?"bg-cyan-600 border-cyan-400 shadow-lg shadow-cyan-900/40 text-white":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-500"}`,children:[e.jsx(F,{size:24}),e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest",children:"IMPRESIÓN"})]}),e.jsxs("button",{onClick:()=>c("Producción"),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center justify-center gap-2 ${s.estado==="Producción"?"bg-indigo-600 border-indigo-400 shadow-lg shadow-indigo-900/40 text-white":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-500"}`,children:[e.jsx(O,{size:24}),e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest",children:"MÁQUINAS"})]}),e.jsxs("button",{onClick:()=>c("Terminado"),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center justify-center gap-2 ${s.estado==="Terminado"?"bg-green-600 border-green-400 shadow-lg shadow-green-900/40 text-white":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-500"}`,children:[e.jsx(T,{size:24}),e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest",children:"BODEGA"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-white/5 flex items-center justify-between",children:[e.jsxs("button",{onClick:Y,className:"px-6 py-3 bg-red-900/30 hover:bg-red-900/50 border border-red-900/20 rounded-xl text-red-500 text-[10px] font-black uppercase flex items-center gap-2 transition-all",children:[e.jsx(U,{size:14})," Solicitar Reproceso"]}),e.jsx("button",{onClick:()=>c("Entregado"),disabled:s.estado==="Entregado",className:"px-8 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl text-[10px] font-black uppercase shadow-lg shadow-emerald-900 transition-all disabled:opacity-20",children:"MARCAR COMO ENTREGADO"})]})]}),s.estado_diseno!=="Aprobado"&&e.jsxs("div",{className:"w-full md:w-80 bg-white/5 border border-white/10 p-6 rounded-[2rem] space-y-4 backdrop-blur-sm",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-blue-300",children:"Entregar Diseño"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"file",id:"design-file",hidden:!0,onChange:t=>z("imagen",t.target.files[0])}),e.jsxs("label",{htmlFor:"design-file",className:`w-full h-12 rounded-xl border-2 border-dashed border-white/20 flex items-center justify-center gap-2 text-[10px] font-black uppercase cursor-pointer transition-all ${n.imagen?"bg-green-500/20 border-green-500/50 text-green-300":"hover:bg-white/10"}`,children:[e.jsx(F,{size:14})," ",n.imagen?"IMAGEN LISTA":"SELECCIONAR ARCHIVO"]}),e.jsx("textarea",{value:n.comentarios,onChange:t=>z("comentarios",t.target.value),placeholder:"Comentarios para el cliente...",className:"w-full bg-white/5 border-white/10 rounded-xl text-[11px] font-bold text-white placeholder:text-white/20 h-16 resize-none focus:ring-blue-500"}),e.jsx("button",{onClick:J,disabled:C||!n.imagen,className:"w-full h-12 bg-blue-600 hover:bg-blue-500 disabled:opacity-30 rounded-xl font-black text-[10px] uppercase shadow-lg shadow-blue-900 transition-all",children:C?"SUBIENDO...":"SUBIR Y NOTIFICAR CLIENTE"})]})]})]})]}),(s.detalle_diseno||s.brief_cliente)&&e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-xl border border-slate-100 overflow-hidden animate-fade-in-up",children:[e.jsx("div",{className:"p-8 border-b border-slate-50 flex justify-between items-center bg-indigo-50/30",children:e.jsxs("h3",{className:"text-sm font-black uppercase tracking-widest text-indigo-500 flex items-center gap-3",children:[e.jsx(M,{size:18,className:"text-indigo-500"})," Instrucciones del Proyecto"]})}),e.jsxs("div",{className:"p-8 grid grid-cols-1 md:grid-cols-2 gap-8",children:[s.detalle_diseno&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Indicaciones de Ventas"}),e.jsx("div",{className:"p-4 bg-slate-50 rounded-2xl border border-slate-100 text-sm font-bold text-slate-700 leading-relaxed",children:s.detalle_diseno}),s.imagen_referencia&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 italic",children:"Adjunto de Ventas"}),e.jsx("img",{src:`/storage/${s.imagen_referencia}`,className:"h-32 w-full object-cover rounded-2xl border border-slate-200 shadow-sm cursor-zoom-in hover:scale-[1.02] transition-transform",onClick:()=>window.open(`/storage/${s.imagen_referencia}`,"_blank")})]})]}),s.brief_cliente&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-widest",children:"Brief del Cliente"}),e.jsx("div",{className:"p-4 bg-indigo-50/50 rounded-2xl border border-indigo-100 text-sm font-bold text-indigo-900 leading-relaxed shadow-inner",children:s.brief_cliente})]}),s.archivo_brief_path&&e.jsxs("div",{className:"pt-2",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 italic",children:"Materiales de Referencia"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("a",{href:`/storage/${s.archivo_brief_path}`,target:"_blank",className:"flex items-center gap-3 p-4 bg-white border-2 border-slate-100 rounded-2xl hover:border-blue-500 hover:bg-blue-50 transition-all group shadow-sm",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center text-slate-400 group-hover:bg-blue-600 group-hover:text-white transition-colors",children:e.jsx(g,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 leading-none mb-1",children:"Descargar"}),e.jsx("div",{className:"text-[11px] font-black text-slate-800 italic",children:"VER ARCHIVO"})]})]}),["jpg","jpeg","png","gif","webp"].some(t=>{var a;return(a=s.archivo_brief_path)==null?void 0:a.toLowerCase().endsWith(t)})&&e.jsxs("div",{className:"relative group/img",children:[e.jsx("img",{src:`/storage/${s.archivo_brief_path}`,className:"h-20 w-20 object-cover rounded-2xl border border-slate-200 shadow-sm cursor-zoom-in group-hover/img:scale-105 transition-transform",onClick:()=>window.open(`/storage/${s.archivo_brief_path}`,"_blank")}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover/img:opacity-100 rounded-2xl pointer-events-none transition-opacity flex items-center justify-center",children:e.jsx(q,{size:16,className:"text-white"})})]})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-xl border border-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"p-8 border-b border-slate-50 flex justify-between items-center bg-slate-50/50",children:[e.jsxs("h3",{className:"text-sm font-black uppercase tracking-widest text-slate-500 flex items-center gap-3",children:[e.jsx(g,{size:18,className:"text-blue-500"})," Detalle de la Orden"]}),e.jsxs("div",{className:"text-xs font-bold text-slate-400 bg-white px-4 py-2 rounded-2xl border border-slate-100 italic",children:["Documento ID: ",s.id]})]}),e.jsx("div",{className:"p-0 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/50",children:[e.jsx("th",{className:"px-8 py-5 text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Producto / Servicio"}),e.jsx("th",{className:"px-8 py-5 text-center text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Cant."}),e.jsx("th",{className:"px-8 py-5 text-right text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Precio"}),e.jsx("th",{className:"px-8 py-5 text-right text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:(A=s.detalles)==null?void 0:A.map(t=>{var a,r,l;return e.jsxs("tr",{className:"group hover:bg-blue-50/30 transition-all",children:[e.jsxs("td",{className:"px-8 py-6",children:[e.jsx("div",{className:"font-black text-slate-800 text-base",children:(a=t.item)==null?void 0:a.nombre}),e.jsxs("div",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-0.5",children:["Categoría: ",((l=(r=t.item)==null?void 0:r.categoria)==null?void 0:l.nombre)||"General"]})]}),e.jsx("td",{className:"px-8 py-6 text-center",children:e.jsx("span",{className:"bg-slate-100 text-slate-900 px-4 py-2 rounded-xl font-black text-sm",children:t.cantidad})}),e.jsx("td",{className:"px-8 py-6 text-right font-bold text-slate-400 italic",children:x(t.precio_unitario)}),e.jsx("td",{className:"px-8 py-6 text-right font-black text-slate-900 text-lg group-hover:text-blue-600 transition-colors",children:x(t.total)})]},t.id)})})]})}),e.jsx("div",{className:"p-10 bg-slate-50 border-t border-slate-100",children:e.jsxs("div",{className:"flex flex-col gap-3 max-w-xs ml-auto",children:[e.jsxs("div",{className:"flex justify-between items-center text-slate-500 font-bold uppercase text-[10px] tracking-widest",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"text-slate-800 text-sm tracking-normal",children:x(s.subtotal)})]}),e.jsxs("div",{className:"flex justify-between items-center text-slate-500 font-bold uppercase text-[10px] tracking-widest",children:[e.jsx("span",{children:"Impuestos (7%)"}),e.jsx("span",{className:"text-slate-800 text-sm tracking-normal",children:x(s.itbms_total)})]}),e.jsx("div",{className:"h-px bg-slate-200 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-black uppercase tracking-[0.2em] text-blue-600",children:"Total Final"}),e.jsx("span",{className:"text-3xl font-black text-slate-900 tracking-tighter italic",children:x(s.total)})]})]})})]}),h.length>0&&e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-xl border border-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"p-8 bg-white border-b border-slate-50 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-sm font-black uppercase tracking-widest text-slate-500 flex items-center gap-3",children:[e.jsx(U,{size:18,className:"text-purple-500"})," Trazabilidad de Revisiones"]}),e.jsxs("span",{className:"bg-purple-50 text-purple-700 px-4 py-1.5 rounded-full text-[10px] font-black uppercase ring-1 ring-purple-100",children:[h.length," Entregas realizadas"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-8",children:[...h].reverse().map((t,a)=>e.jsxs("div",{className:"bg-white border border-slate-100 rounded-3xl p-5 shadow-sm hover:shadow-xl transition-all hover:scale-[1.02] relative group",children:[e.jsxs("div",{className:"absolute -top-3 -left-3 w-8 h-8 bg-slate-900 text-white rounded-full flex items-center justify-center font-black text-[10px] shadow-lg group-hover:bg-blue-600 transition-colors",children:["#",h.length-a]}),e.jsx("img",{src:`/storage/${t.imagen}`,className:"w-full h-40 object-cover rounded-2xl mb-4 shadow-inner ring-1 ring-slate-100 cursor-zoom-in",onClick:()=>window.open(`/storage/${t.imagen}`,"_blank")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-[9px] font-black uppercase ${t.estado==="Aprobado"?"bg-green-100 text-green-700":t.estado==="Rechazado"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:t.estado}),e.jsxs("span",{className:"text-[9px] font-black text-slate-300 uppercase italic",children:["REV #",t.intento]})]}),e.jsx("p",{className:"text-[11px] font-bold text-slate-600 line-clamp-3 italic leading-relaxed",children:t.comentarios_cliente||t.comentarios_staff||"Sin comentarios"}),e.jsxs("div",{className:"text-[9px] text-slate-400 font-bold pt-2 border-t border-slate-50 flex items-center gap-1.5",children:[e.jsx(v,{size:10})," ",new Date(t.created_at).toLocaleString()]})]})]},t.id))})]})]}),e.jsx("div",{className:"lg:col-span-4 lg:sticky lg:top-8 self-start h-[calc(100vh-4rem)]",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl border border-slate-100 flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b bg-slate-900 text-white flex items-center justify-between shadow-lg",children:[e.jsxs("h3",{className:"font-black text-xs uppercase tracking-[0.2em] flex items-center gap-3",children:[e.jsx(L,{size:20,className:"text-blue-400"})," Chat Operativo"]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-500/10 rounded-full ring-1 ring-green-500/20",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)]"}),e.jsx("span",{className:"text-[10px] font-black text-green-400 tracking-tighter",children:"CLIENTE ONLINE"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-slate-50/30",children:[j.length===0&&e.jsxs("div",{className:"text-center py-32 opacity-10",children:[e.jsx(L,{size:64,className:"mx-auto mb-4"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-[0.4em]",children:"Inicia la conversación"})]}),j.map((t,a)=>e.jsx("div",{className:`flex ${t.emisor==="staff"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:"max-w-[85%] group",children:e.jsxs("div",{className:`p-4 rounded-3xl shadow-sm relative ${t.emisor==="staff"?"bg-blue-600 text-white rounded-tr-none":"bg-white text-slate-800 border border-slate-200 rounded-tl-none shadow-slate-200/50"}`,children:[e.jsx("p",{className:"text-xs font-bold leading-relaxed",children:t.texto}),t.requiere_aprobacion&&e.jsxs("div",{className:"mt-3 py-2 px-3 bg-yellow-400 text-yellow-950 text-[9px] font-black rounded-xl uppercase flex items-center gap-2 shadow-inner",children:[e.jsx(v,{size:12,className:"animate-pulse"})," PENDIENTE DE APROBACIÓN"]}),e.jsxs("div",{className:`text-[8px] mt-2 opacity-60 font-black italic flex items-center gap-1 ${t.emisor==="staff"?"justify-end":"justify-start"}`,children:[e.jsx(v,{size:8})," ",new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})})},a)),e.jsx("div",{ref:S})]}),e.jsxs("form",{onSubmit:Z,className:"p-6 border-t bg-white space-y-4 shadow-inner",children:[e.jsx("textarea",{value:o.mensaje_texto,onChange:t=>D("mensaje_texto",t.target.value),placeholder:"Escribe aquí tu mensaje externo...",className:"w-full border-2 border-slate-100 rounded-3xl text-sm font-bold focus:ring-0 focus:border-blue-500 h-28 bg-slate-50/50 p-5 shadow-inner placeholder:text-slate-300 transition-all"}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3 text-[10px] font-black text-slate-400 cursor-pointer hover:text-blue-600 transition-colors uppercase tracking-widest leading-none",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:o.requiere_aprobacion,onChange:t=>D("requiere_aprobacion",t.target.checked),className:"peer appearance-none w-5 h-5 border-2 border-slate-200 rounded-lg checked:bg-blue-600 checked:border-blue-600 transition-all cursor-pointer"}),e.jsx(T,{size:12,className:"absolute top-1 left-1 text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity"})]}),"Pedir Aprobación"]}),e.jsxs("button",{type:"submit",disabled:!o.mensaje_texto||Q,className:"bg-blue-600 text-white px-8 py-4 rounded-2xl font-black text-xs flex items-center gap-3 disabled:opacity-20 hover:bg-blue-700 transition-all hover:scale-105 active:scale-95 shadow-xl shadow-blue-100",children:[e.jsx(re,{size:16})," ENVIAR"]})]})]})]})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-700 to-indigo-800 rounded-[2.5rem] p-8 text-white flex flex-col md:flex-row justify-between items-center gap-8 shadow-2xl",children:[e.jsxs("div",{className:"space-y-3 text-center md:text-left",children:[e.jsxs("h3",{className:"font-black text-2xl flex items-center justify-center md:justify-start gap-4 uppercase tracking-tighter italic",children:[e.jsx(q,{size:28,className:"text-blue-300"})," Link de Seguimiento"]}),e.jsx("p",{className:"text-blue-100/60 text-xs font-bold uppercase tracking-[0.2em]",children:"Enlace público para que el cliente apruebe diseños y revise su pedido."})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-white/10 p-2 rounded-3xl border border-white/10 backdrop-blur-md",children:[e.jsxs("div",{className:"px-5 font-mono text-sm opacity-60 text-blue-200 hidden sm:block",children:["...",(I=s.tracking_token)==null?void 0:I.substring(0,12),"..."]}),e.jsxs("button",{onClick:ee,className:"bg-white text-blue-900 px-10 py-5 rounded-2xl font-black text-sm hover:bg-blue-50 flex items-center gap-3 transition-all active:scale-95 shadow-2xl",children:[e.jsx(oe,{size:20})," COPIAR ENLACE PRIVADO"]})]})]})]}),e.jsx("style",{children:`
                @keyframes shimmer {
                    100% { transform: translateX(100%); }
                }
                .animate-spin-slow {
                    animation: spin 8s linear infinite;
                }
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `})]}):null}export{_e as default};
