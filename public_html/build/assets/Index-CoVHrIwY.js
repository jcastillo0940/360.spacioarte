import{r as l,j as e,H as M,L as p,a as b}from"./app-BfpvEa9J.js";import{A as g}from"./AuthenticatedLayout-BAkMyy8i.js";function B(){const[r,h]=l.useState([]),[f,j]=l.useState([]),[v,u]=l.useState(!0),[o,n]=l.useState([]),[N,i]=l.useState(!1),[c,w]=l.useState("");l.useEffect(()=>{x(),k()},[]);const x=()=>{fetch("/api/ventas/ordenes").then(t=>t.json()).then(t=>{h(t||[]),u(!1)}).catch(t=>{console.error("Error loading ordenes:",t),h([]),u(!1)})},k=()=>{fetch("/api/inventario/contactos").then(t=>t.json()).then(t=>{const s=Array.isArray(t)?t.filter(a=>a.es_proveedor):[];j(s)})},y=t=>{confirm("¿Convertir esta orden en factura de venta? Se actualizará el inventario y se registrará la venta.")&&b.post(`/ventas/facturas/convertir/${t}`,{},{onSuccess:()=>x()})},C=t=>{n(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},L=()=>{if(!c)return alert("Seleccione un proveedor");b.post(route("compras.consolidar.store"),{venta_ids:o,contacto_id:c},{onSuccess:()=>{i(!1),n([]),x()}})},S=t=>({Borrador:"bg-slate-100 text-slate-700",Confirmada:"bg-blue-100 text-blue-700",Facturada:"bg-green-100 text-green-700",Cancelada:"bg-red-100 text-red-700"})[t]||"bg-slate-100 text-slate-700",m=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t||0),d={total:r.length,confirmadas:r.filter(t=>t.estado==="Confirmada").length,facturadas:r.filter(t=>t.estado==="Facturada").length,valorTotal:r.reduce((t,s)=>t+parseFloat(s.total||0),0)};return v?e.jsx(g,{children:e.jsxs("div",{className:"max-w-7xl mx-auto p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4 font-bold",children:"Cargando órdenes..."})]})}):e.jsxs(g,{children:[e.jsx(M,{title:"Órdenes de Venta"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-900 flex items-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Órdenes de Venta"]}),e.jsx("p",{className:"text-slate-600 mt-2 font-medium",children:"Gestión de pedidos y consolidación de compras"})]}),e.jsxs("div",{className:"flex gap-3",children:[o.length>0&&e.jsxs("button",{onClick:()=>i(!0),className:"px-6 py-3 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition flex items-center gap-2 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),"Consolidar (",o.length,")"]}),e.jsxs(p,{href:route("ordenes.create"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition shadow-lg flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nueva Orden"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm",children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Total Pedidos"}),e.jsx("div",{className:"text-3xl font-black text-slate-900 mt-1",children:d.total})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-blue-500",children:[e.jsx("div",{className:"text-xs font-bold text-blue-500 uppercase tracking-wider",children:"Confirmadas"}),e.jsx("div",{className:"text-3xl font-black text-slate-900 mt-1",children:d.confirmadas})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-green-500",children:[e.jsx("div",{className:"text-xs font-bold text-green-500 uppercase tracking-wider",children:"Facturadas"}),e.jsx("div",{className:"text-3xl font-black text-slate-900 mt-1",children:d.facturadas})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-slate-900",children:[e.jsx("div",{className:"text-xs font-bold text-slate-900 uppercase tracking-wider",children:"Valor Global"}),e.jsx("div",{className:"text-3xl font-black text-slate-900 mt-1",children:m(d.valorTotal)})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-900 text-white text-xs uppercase font-bold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 w-10 text-center",children:e.jsx("input",{type:"checkbox",className:"rounded border-slate-700 text-blue-600 focus:ring-blue-500 bg-slate-800 cursor-pointer",onChange:t=>{if(t.target.checked){const s=r.filter(a=>a.estado!=="Facturada").map(a=>a.id);n(s)}else n([])}})}),e.jsx("th",{className:"px-6 py-4",children:"Orden #"}),e.jsx("th",{className:"px-6 py-4",children:"Cliente / RUC"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Monto Total"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Estado"}),e.jsx("th",{className:"px-6 py-4 text-center",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-10 text-center text-slate-400 font-medium",children:"No se encontraron registros."})}):r.map(t=>{var s,a;return e.jsxs("tr",{className:`${o.includes(t.id)?"bg-blue-50":t.estado==="Facturada"?"bg-slate-50 opacity-60":"hover:bg-slate-50"} transition-colors`,children:[e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",checked:o.includes(t.id),disabled:t.estado==="Facturada",onChange:()=>C(t.id),className:`rounded border-slate-300 focus:ring-blue-500 ${t.estado==="Facturada"?"cursor-not-allowed":"text-blue-600 cursor-pointer"}`})}),e.jsx("td",{className:"px-6 py-4 font-mono font-bold text-slate-900",children:t.numero_orden}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-bold text-slate-900",children:(s=t.cliente)==null?void 0:s.razon_social}),e.jsx("div",{className:"text-xs text-slate-500",children:(a=t.cliente)==null?void 0:a.identificacion})]}),e.jsx("td",{className:"px-6 py-4 text-right font-black text-slate-900",children:m(t.total)}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter ${S(t.estado)}`,children:t.estado})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(p,{href:route("ordenes.show",t.id),className:"p-2 bg-slate-100 text-slate-600 rounded-lg hover:bg-slate-900 hover:text-white transition shadow-sm",children:e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),t.estado==="Confirmada"&&e.jsx("button",{onClick:()=>y(t.id),className:"p-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-700 hover:text-white transition shadow-sm",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]})})]},t.id)})})]})})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full border border-slate-200",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("h3",{className:"text-2xl font-black text-slate-900",children:"Consolidar Compras"}),e.jsx("p",{className:"text-slate-500 text-sm mt-1 mb-6",children:"Selecciona el proveedor al cual se le enviará esta orden unificada."}),e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2",children:"Proveedor del Pedido"}),e.jsxs("select",{className:"w-full rounded-xl border-slate-200 bg-slate-50 py-3 font-bold text-slate-700 focus:ring-indigo-500 focus:border-indigo-500 transition",value:c,onChange:t=>w(t.target.value),children:[e.jsx("option",{value:"",children:"Buscar en contactos..."}),f.map(t=>e.jsx("option",{value:t.id,children:t.razon_social||t.nombre},t.id))]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx("button",{onClick:()=>i(!1),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-xl font-bold hover:bg-slate-200 transition",children:"Ignorar"}),e.jsx("button",{onClick:L,className:"flex-1 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-200",children:"Procesar Ahora"})]})]})})]})}export{B as default};
