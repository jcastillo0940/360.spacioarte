import{r,u as E,j as e,H as C,L as I,a as d}from"./app-B9gv8ZBn.js";import{A as P}from"./AuthenticatedLayout-BtVr5BZh.js";import{A as R}from"./arrow-left-CfjbLpYN.js";import{P as T}from"./palette-DG73C3F0.js";import{P as z}from"./play-BXk8bIIm.js";import{c as A}from"./createLucideIcon-CS3OZA2G.js";import{F as D}from"./file-text-giW9wa2H.js";import{U as j}from"./upload-7iKC3RfR.js";import{C as O}from"./circle-check-big-DI7VEtmR.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],V=A("pause",L);function Q({orden:t}){var b,u,f;const[n,c]=r.useState(!1),[N,x]=r.useState(0),[$,F]=r.useState(null),{data:o,setData:m,post:v,processing:p,reset:w,errors:h}=E({imagen:null,comentarios:""});r.useEffect(()=>{if(t.tiempos&&t.tiempos.length>0){let s=0,a=!1;t.tiempos.forEach(l=>{const i=new Date(l.hora_inicio);if(l.hora_fin){const g=new Date(l.hora_fin);s+=Math.floor((g-i)/1e3)}else a=!0,s+=Math.floor((new Date-i)/1e3)}),x(s),c(a)}},[t.tiempos]),r.useEffect(()=>{let s=null;return n&&(s=setInterval(()=>{x(a=>a+1)},1e3)),()=>{s&&clearInterval(s)}},[n]);const y=s=>{const a=Math.floor(s/3600),l=Math.floor(s%3600/60),i=s%60;return`${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},_=()=>{fetch("/api/diseno/timer/start",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({orden_id:t.id,fase:"Diseño"})}).then(()=>{c(!0),d.reload({only:["orden"]})})},k=()=>{fetch("/api/diseno/timer/stop",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({orden_id:t.id,fase:"Diseño"})}).then(()=>{c(!1),d.reload({only:["orden"]})})},S=s=>{s.preventDefault(),v(route("produccion.diseno.enviar",t.id),{onSuccess:()=>{w(),d.reload()}})};return e.jsxs(P,{children:[e.jsx(C,{title:`Diseño - ${t.numero_orden}`}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{href:route("produccion.diseno.index"),className:"p-2 hover:bg-slate-100 rounded-xl transition",children:e.jsx(R,{size:24,className:"text-slate-600"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-slate-900 flex items-center gap-3",children:[e.jsx(T,{className:"text-purple-600",size:32}),"PROCESO DE DISEÑO"]}),e.jsxs("p",{className:"text-slate-500 font-medium mt-1",children:["Orden #",t.numero_orden," - ",(b=t.cliente)==null?void 0:b.razon_social]})]})]}),e.jsxs("div",{className:"bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-lg",children:[e.jsx("div",{className:"text-xs uppercase tracking-widest opacity-70 mb-1",children:"Tiempo de Diseño"}),e.jsx("div",{className:"text-3xl font-black font-mono",children:y(N)}),e.jsx("div",{className:"flex gap-2 mt-3",children:n?e.jsxs("button",{onClick:k,className:"bg-orange-600 hover:bg-orange-500 text-white px-4 py-2 rounded-xl font-bold text-xs uppercase flex items-center gap-2 transition",children:[e.jsx(V,{size:14})," Pausar"]}):e.jsxs("button",{onClick:_,className:"bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-xl font-bold text-xs uppercase flex items-center gap-2 transition",children:[e.jsx(z,{size:14,fill:"currentColor"})," Iniciar"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsxs("h3",{className:"font-black text-sm uppercase tracking-wider text-slate-400 mb-4 flex items-center gap-2",children:[e.jsx(D,{size:16})," Instrucciones del Proyecto"]}),t.detalle_diseno?e.jsx("p",{className:"text-slate-700 text-sm leading-relaxed",children:t.detalle_diseno}):e.jsx("p",{className:"text-slate-400 italic text-sm",children:"Sin instrucciones específicas"})]}),t.brief_cliente&&e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsx("h3",{className:"font-black text-sm uppercase tracking-wider text-slate-400 mb-4",children:"Brief del Cliente"}),e.jsx("p",{className:"text-slate-700 text-sm leading-relaxed",children:t.brief_cliente})]}),t.archivo_brief_path&&e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsx("h3",{className:"font-black text-sm uppercase tracking-wider text-slate-400 mb-4",children:"Materiales de Referencia"}),e.jsxs("a",{href:`/storage/${t.archivo_brief_path}`,target:"_blank",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-bold text-sm",children:[e.jsx(j,{size:16})," Descargar"]}),e.jsx("a",{href:`/storage/${t.archivo_brief_path}`,target:"_blank",className:"mt-2 block text-xs text-slate-500 hover:underline",children:"VER ARCHIVO"})]})]}),e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsx("h3",{className:"font-black text-sm uppercase tracking-wider text-slate-400 mb-4",children:"Trazabilidad de Revisiones"}),e.jsxs("p",{className:"text-xs text-slate-500 mb-4",children:[((u=t.diseno_historial)==null?void 0:u.length)||0," Entregas realizadas"]}),e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:t.diseno_historial&&t.diseno_historial.length>0?t.diseno_historial.map((s,a)=>e.jsxs("div",{className:`p-4 rounded-xl border-2 ${s.estado==="Aprobado"?"bg-green-50 border-green-200":s.estado==="Rechazado"?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-black text-xs uppercase",children:["#",t.diseno_historial.length-a]}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-[10px] font-black uppercase ${s.estado==="Aprobado"?"bg-green-200 text-green-800":s.estado==="Rechazado"?"bg-red-200 text-red-800":"bg-blue-200 text-blue-800"}`,children:s.estado})]}),e.jsxs("div",{className:"text-[10px] text-slate-500 font-bold mb-2",children:["REV #",s.intento]}),s.comentarios_cliente&&e.jsx("p",{className:"text-sm text-slate-700 mb-2",children:s.comentarios_cliente}),s.comentarios_staff&&e.jsx("p",{className:"text-sm text-slate-700 mb-2 italic",children:s.comentarios_staff}),e.jsx("div",{className:"text-[10px] text-slate-400 mt-2",children:new Date(s.created_at).toLocaleString("es-PA")})]},s.id)):e.jsx("p",{className:"text-slate-400 italic text-sm text-center py-8",children:"Sin historial de revisiones"})})]})}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100",children:[e.jsx("h3",{className:"font-black text-sm uppercase tracking-wider text-slate-400 mb-4",children:"Enviar Propuesta al Cliente"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Imagen de Propuesta (JPG/PNG)"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 rounded-xl p-8 text-center hover:bg-slate-50 transition-colors cursor-pointer relative",children:[e.jsx("input",{type:"file",accept:"image/*",required:!0,onChange:s=>m("imagen",s.target.files[0]),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsx(j,{className:"mx-auto text-slate-400 mb-2",size:32}),e.jsx("span",{className:"text-sm font-bold text-slate-600 block",children:o.imagen?o.imagen.name:"Click para seleccionar archivo"})]}),h.imagen&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.imagen})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Comentarios para el Cliente"}),e.jsx("textarea",{className:"w-full border-slate-200 rounded-xl text-sm",rows:"4",placeholder:"Hola, te envío la propuesta lista...",value:o.comentarios,onChange:s=>m("comentarios",s.target.value)})]}),e.jsx("button",{disabled:p,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-black py-3 rounded-xl shadow-lg shadow-purple-200 disabled:opacity-50 flex justify-center items-center gap-2",children:p?"Enviando...":e.jsxs(e.Fragment,{children:[e.jsx(O,{size:18}),t.estado_diseno==="Enviado"?"ENVIAR NUEVA VERSIÓN":"ENVIAR AL CLIENTE"]})})]})]}),e.jsxs("div",{className:"bg-slate-50 p-6 rounded-2xl border border-slate-200",children:[e.jsx("h4",{className:"font-black text-xs uppercase tracking-wider text-slate-400 mb-3",children:"Información de la Orden"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Estado:"}),e.jsx("span",{className:"font-bold text-slate-900",children:t.estado})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Fecha Entrega:"}),e.jsx("span",{className:"font-bold text-slate-900",children:t.fecha_entrega})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Intentos:"}),e.jsx("span",{className:"font-bold text-slate-900",children:t.diseno_intentos||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500",children:"Vendedor:"}),e.jsx("span",{className:"font-bold text-slate-900",children:((f=t.vendedor)==null?void 0:f.nombre)||"N/A"})]})]})]})]})]})]})]})}export{Q as default};
