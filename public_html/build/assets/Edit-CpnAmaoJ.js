import{r as l,u as z,j as e,H as j}from"./app-3DoqhR_o.js";import{A as v}from"./AuthenticatedLayout-314zbiSn.js";function H({ordenId:c}){const[n,N]=l.useState(null),[w,_]=l.useState([]),[m,y]=l.useState([]),[h,x]=l.useState([]),[C,p]=l.useState(!0),[k,b]=l.useState(""),[L,u]=l.useState(!1),{data:r,setData:d,put:S,processing:g,errors:R}=z({contacto_id:"",fecha_pedido:"",fecha_entrega:"",estado:"",items:[]}),[E,P]=l.useState(0);l.useEffect(()=>{Promise.all([fetch(`/api/compras/ordenes/${c}`).then(s=>s.json()),fetch("/api/compras/ordenes/datos").then(s=>s.json())]).then(([s,t])=>{var a;N(s),_(t.proveedores||[]),y(t.productos||[]),x(t.productos||[]),d({contacto_id:s.contacto_id,fecha_pedido:s.fecha_emision,fecha_entrega:s.fecha_entrega||"",estado:s.estado,items:((a=s.detalles)==null?void 0:a.map(o=>{var i;return{item_id:o.item_id,nombre:(i=o.item)==null?void 0:i.nombre,cantidad:o.cantidad,costo_unitario:o.costo_unitario}}))||[]}),p(!1)}).catch(s=>{console.error("Error loading data:",s),p(!1)})},[c]);const F=s=>{if(b(s),s.length===0)x(m),u(!1);else{const t=m.filter(a=>a.nombre.toLowerCase().includes(s.toLowerCase())||a.codigo.toLowerCase().includes(s.toLowerCase()));x(t),u(!0)}},T=s=>{if(r.items.find(a=>a.item_id===s.id)){const a=r.items.map(o=>o.item_id===s.id?{...o,cantidad:o.cantidad+1}:o);d("items",a)}else{const a={item_id:s.id,nombre:s.nombre,cantidad:1,costo_unitario:s.costo_promedio||0};d("items",[...r.items,a])}b(""),u(!1)},B=s=>{d("items",r.items.filter(t=>t.item_id!==s))},f=(s,t,a)=>{const o=r.items.map(i=>i.item_id===s?{...i,[t]:parseFloat(a)||0}:i);d("items",o)};l.useEffect(()=>{const s=r.items.reduce((t,a)=>t+a.cantidad*a.costo_unitario,0);P(s)},[r.items]);const I=s=>{s.preventDefault(),S(`/compras/ordenes/${c}`)};return C?e.jsxs(v,{children:[e.jsx(j,{title:"Editando..."}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4",children:"Cargando orden..."})]})})]}):e.jsxs(v,{children:[e.jsx(j,{title:`Editar ${n==null?void 0:n.numero_orden}`}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-black text-slate-900 flex items-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Editar Orden de Compra"]}),e.jsx("p",{className:"text-slate-600 mt-2 font-mono text-lg",children:n==null?void 0:n.numero_orden})]}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"InformaciÃ³n General"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Proveedor *"}),e.jsx("select",{value:r.contacto_id,onChange:s=>d("contacto_id",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition",required:!0,children:w.map(s=>e.jsx("option",{value:s.id,children:s.razon_social},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Fecha Pedido *"}),e.jsx("input",{type:"date",value:r.fecha_pedido,onChange:s=>d("fecha_pedido",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Fecha Entrega *"}),e.jsx("input",{type:"date",value:r.fecha_entrega,onChange:s=>d("fecha_entrega",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Estado *"}),e.jsxs("select",{value:r.estado,onChange:s=>d("estado",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition",required:!0,children:[e.jsx("option",{value:"Borrador",children:"Borrador"}),e.jsx("option",{value:"Confirmada",children:"Confirmada"}),e.jsx("option",{value:"Recibida Parcial",children:"Recibida Parcial"}),e.jsx("option",{value:"Recibida Total",children:"Recibida Total"}),e.jsx("option",{value:"Cancelada",children:"Cancelada"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Buscar Producto"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:k,onChange:s=>F(s.target.value),placeholder:"Buscar...",className:"w-full px-4 py-3 rounded-lg border border-slate-300",autoComplete:"off"}),L&&h.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border rounded-lg shadow-lg max-h-64 overflow-y-auto",children:h.map(s=>e.jsxs("button",{type:"button",onClick:()=>T(s),className:"w-full text-left p-3 hover:bg-green-50 border-b",children:[e.jsx("div",{className:"font-bold",children:s.nombre}),e.jsx("div",{className:"text-xs text-slate-500",children:s.codigo})]},s.id))})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4",children:["Items (",r.items.length,")"]}),r.items.length===0?e.jsx("p",{className:"text-center text-slate-400 py-8",children:"No hay productos"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b-2",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-3 text-left text-xs font-bold uppercase",children:"Producto"}),e.jsx("th",{className:"pb-3 text-center text-xs font-bold uppercase",children:"Cant."}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase",children:"Costo"}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase",children:"Total"}),e.jsx("th",{className:"pb-3"})]})}),e.jsx("tbody",{className:"divide-y",children:r.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-3",children:s.nombre}),e.jsx("td",{className:"py-3",children:e.jsx("input",{type:"number",className:"w-20 mx-auto text-center px-2 py-2 border rounded-lg",value:s.cantidad,onChange:t=>f(s.item_id,"cantidad",t.target.value),step:"0.01"})}),e.jsx("td",{className:"py-3",children:e.jsx("input",{type:"number",step:"0.01",className:"w-24 ml-auto text-right px-2 py-2 border rounded-lg",value:s.costo_unitario,onChange:t=>f(s.item_id,"costo_unitario",t.target.value)})}),e.jsxs("td",{className:"py-3 text-right font-bold",children:["$",(s.cantidad*s.costo_unitario).toFixed(2)]}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>B(s.item_id),className:"text-red-500",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},s.item_id))})]})]})]}),e.jsxs("div",{className:"bg-green-800 text-white p-6 rounded-lg shadow-lg h-fit sticky top-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-6",children:"Total"}),e.jsxs("div",{className:"flex justify-between text-2xl font-black border-t border-green-700 pt-4",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",E.toFixed(2)]})]}),e.jsx("button",{type:"submit",disabled:g||r.items.length===0,className:"w-full bg-green-600 text-white mt-6 py-4 rounded-lg font-bold hover:bg-green-500 transition disabled:bg-slate-600",children:g?"Guardando...":"Actualizar Orden"})]})]})]})]})]})}export{H as default};
