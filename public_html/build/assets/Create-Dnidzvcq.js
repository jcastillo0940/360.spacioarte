import{r as c,u as $,j as e,H as O,c as ie}from"./app-BqyPfEI0.js";import{A}from"./AuthenticatedLayout-ChjIDkpR.js";function xe(){const[_,N]=c.useState([]),[d,u]=c.useState([]),[w,m]=c.useState([]),[T,M]=c.useState([]),[z,k]=c.useState([]),[r,h]=c.useState(50),[y,j]=c.useState([]),[E,D]=c.useState(!0),[F,I]=c.useState(""),[P,C]=c.useState(!1),[V,q]=c.useState(!1),{data:a,setData:l,post:W,processing:R,errors:S}=$({contacto_id:"",sucursal_id:"",vendedor_id:"",fecha_emision:new Date().toISOString().split("T")[0],fecha_entrega:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],items:[],imagen_referencia:null,monto_abonado:0,metodo_pago_inicial:"Transferencia",metodo_pago_referencia:"",cliente_envia_muestra:!1,cliente_envia_archivo:!1,detalle_diseno:""}),[H,U]=c.useState(0),[G,J]=c.useState(0),[f,Y]=c.useState(0);c.useEffect(()=>{K()},[]);const K=()=>{fetch("/api/ventas/ordenes/datos").then(s=>s.json()).then(s=>{N(s.clientes||[]),u(s.productos||[]),m(s.productos||[]),M(s.vendedores||[]),k(s.payment_terms||[]),h(s.min_anticipo_porcentaje||50),s.vendedor_asignado_id&&l("vendedor_id",s.vendedor_asignado_id),D(!1)}).catch(s=>{console.error("Error loading data:",s),N([]),u([]),m([]),M([]),D(!1)})},Q=s=>{if(!s){j([]),l("sucursal_id","");return}fetch(`/api/inventario/sucursales/contacto/${s}`).then(t=>t.json()).then(t=>{j(t||[]),(t||[]).length>0?l("sucursal_id",t[0].id):l("sucursal_id","")}).catch(t=>{console.error("Error loading sucursales:",t),j([])})},X=s=>{if(I(s),s.length===0)m(d),C(!1);else{const t=d.filter(n=>n.nombre.toLowerCase().includes(s.toLowerCase())||n.codigo.toLowerCase().includes(s.toLowerCase())||n.categoria&&n.categoria.toLowerCase().includes(s.toLowerCase()));m(t),C(!0)}},Z=(s,t,n)=>{if(!s.requires_recipe||!t||!n)return null;const i=parseFloat(t.ancho_imprimible||t.ancho||0),o=parseFloat(t.largo_imprimible||t.largo||0),x=parseFloat(s.ancho_imprimible||0),p=parseFloat(s.largo_imprimible||0),v=parseFloat(s.sangrado||0),b=parseFloat(s.separacion_piezas||0);if(i<=0||o<=0||x<=0||p<=0)return null;const g=Math.floor((i-v*2)/(x+b)),le=Math.floor((o-v*2)/(p+b));let L=g*le;if(s.permite_rotacion){const re=Math.floor((i-v*2)/(p+b)),oe=Math.floor((o-v*2)/(x+b)),B=re*oe;B>L&&(L=B)}return L>0?L:0},ee=s=>{var n,i,o;if(a.items.find(x=>x.item_id===s.id)){const x=a.items.map(p=>p.item_id===s.id?{...p,cantidad:p.cantidad+1}:p);l("items",x)}else{const x={item_id:s.id,nombre:s.nombre,cantidad:1,precio_unitario:s.precio_venta,tasa_itbms:((n=s.tax)==null?void 0:n.tasa)||0,requires_recipe:s.requires_recipe,tipo_impresion:s.tipo_impresion,procesos_compatibles:s.procesos_compatibles||[],papeles_compatibles:s.papeles_compatibles||[],ancho_imprimible:s.ancho_imprimible,largo_imprimible:s.largo_imprimible,sangrado:s.sangrado,separacion_piezas:s.separacion_piezas,permite_rotacion:s.permite_rotacion,proceso_id:((i=s.procesos_compatibles)==null?void 0:i.length)===1?s.procesos_compatibles[0].id:"",material_id:((o=s.papeles_compatibles)==null?void 0:o.length)===1?s.papeles_compatibles[0].id:"",pliegos_necesarios:0,capacidad_por_pliego:0,total_piezas_calculadas:0};l("items",[...a.items,x])}I(""),C(!1)},se=s=>{l("items",a.items.filter(t=>t.item_id!==s))},te=(s,t)=>{const n=a.items.map(i=>i.item_id===s?{...i,cantidad:parseFloat(t)||0}:i);l("items",n)};c.useEffect(()=>{let s=0,t=0;const n=a.items.map(o=>{const x=o.cantidad*o.precio_unitario;if(s+=x,t+=x*(o.tasa_itbms/100),o.requires_recipe&&o.proceso_id&&o.material_id){const p=o.papeles_compatibles.find(g=>g.id==o.material_id),v=o.procesos_compatibles.find(g=>g.id==o.proceso_id),b=Z(o,p,v);if(b!==null){const g=Math.ceil(o.cantidad/b);return{...o,capacidad_por_pliego:b,pliegos_necesarios:g,total_piezas_calculadas:o.cantidad}}}return o});JSON.stringify(n)!==JSON.stringify(a.items)&&l("items",n),U(s),J(t),Y(s+t)},[a.items]);const ae=s=>{s.preventDefault(),W(route("ordenes.store"))};return E?e.jsxs(A,{children:[e.jsx(O,{title:"Nueva Orden de Venta"}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4",children:"Cargando datos..."})]})})]}):e.jsxs(A,{children:[e.jsx(O,{title:"Nueva Orden de Venta"}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8 flex justify-between items-center",children:e.jsxs("h1",{className:"text-3xl font-black text-slate-900 flex items-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Nueva Orden de Venta"]})}),e.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Información del Cliente"]}),e.jsxs("button",{type:"button",onClick:()=>q(!0),className:"bg-blue-50 text-blue-600 px-4 py-2 rounded-lg font-bold text-xs uppercase tracking-widest hover:bg-blue-100 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Nuevo Cliente"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Cliente *"}),e.jsxs("select",{value:a.contacto_id,onChange:s=>{l("contacto_id",s.target.value),Q(s.target.value)},className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",required:!0,children:[e.jsx("option",{value:"",children:"Seleccione un cliente"}),_.map(s=>e.jsxs("option",{value:s.id,children:[s.razon_social," ",s.identificacion?`(${s.identificacion})`:""]},s.id))]}),S.contacto_id&&e.jsx("span",{className:"text-red-500 text-xs",children:S.contacto_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Sucursal"}),e.jsxs("select",{value:a.sucursal_id,onChange:s=>l("sucursal_id",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",disabled:!a.contacto_id,children:[e.jsx("option",{value:"",children:"Sucursal principal"}),y.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Vendedor"}),e.jsxs("select",{value:a.vendedor_id,onChange:s=>l("vendedor_id",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",children:[e.jsx("option",{value:"",children:"Sin vendedor"}),T.map(s=>e.jsx("option",{value:s.id,children:s.nombre_completo},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Fecha Entrega"}),e.jsx("input",{type:"date",value:a.fecha_entrega,onChange:s=>l("fecha_entrega",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Imagen de Referencia"}),e.jsx("input",{type:"file",onChange:s=>l("imagen_referencia",s.target.files[0]),className:"w-full px-4 py-2.5 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition text-xs",accept:"image/*"})]}),e.jsxs("div",{className:"lg:col-span-2 bg-slate-50 p-6 rounded-xl border border-slate-200 space-y-4",children:[e.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400 mb-2 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),"Opciones de Seguimiento y Diseño"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-white border border-slate-200 rounded-lg cursor-pointer hover:border-blue-300 transition group",children:[e.jsx("input",{type:"checkbox",checked:a.cliente_envia_muestra,onChange:s=>l("cliente_envia_muestra",s.target.checked),className:"w-5 h-5 text-blue-600 rounded border-slate-300 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs font-bold text-slate-700 group-hover:text-blue-600 transition",children:"El cliente enviará muestra física"})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-white border border-slate-200 rounded-lg cursor-pointer hover:border-blue-300 transition group",children:[e.jsx("input",{type:"checkbox",checked:a.cliente_envia_archivo,onChange:s=>l("cliente_envia_archivo",s.target.checked),className:"w-5 h-5 text-blue-600 rounded border-slate-300 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs font-bold text-slate-700 group-hover:text-blue-600 transition",children:"El cliente enviará imagen/archivo"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-slate-500",children:"Detalles para Diseño / Brief del Cliente"}),e.jsx("textarea",{rows:"3",value:a.detalle_diseno,onChange:s=>l("detalle_diseno",s.target.value),placeholder:"Instrucciones específicas, textos, correos o especificaciones que el diseñador deba saber...",className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition text-sm font-medium"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Buscar Producto"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:F,onChange:s=>X(s.target.value),onFocus:()=>F&&C(!0),placeholder:"Buscar por nombre, código o categoría...",className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",autoComplete:"off"}),P&&w.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-64 overflow-y-auto",children:w.map(s=>e.jsx("button",{type:"button",onClick:()=>ee(s),className:"w-full text-left p-3 hover:bg-blue-50 border-b border-slate-100 last:border-0 transition",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-slate-900",children:s.nombre}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[e.jsx("span",{className:"font-mono",children:s.codigo}),s.categoria&&e.jsxs("span",{className:"ml-2",children:["• ",s.categoria]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:"font-bold text-blue-600",children:["$",s.precio_venta]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Stock: ",s.stock_actual||"N/A"]})]})]})},s.id))}),P&&F&&w.length===0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron productos"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),"Items en la Orden (",a.items.length,")"]}),a.items.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("p",{className:"font-bold",children:"No hay productos añadidos"}),e.jsx("p",{className:"text-sm mt-1",children:"Usa el buscador para agregar productos"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b-2 border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-3 text-left text-xs font-bold uppercase text-slate-600",children:"Producto"}),e.jsx("th",{className:"pb-3 text-center text-xs font-bold uppercase text-slate-600",children:"Cant."}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase text-slate-600",children:"Precio"}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase text-slate-600",children:"Subtotal"}),e.jsx("th",{className:"pb-3"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:a.items.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{className:"py-3",children:[e.jsx("div",{className:"font-medium text-slate-900",children:s.nombre}),s.requires_recipe&&e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 p-2 bg-slate-50 rounded-lg border border-slate-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[9px] font-black uppercase text-slate-400 mb-1",children:"Máquina"}),e.jsxs("select",{className:"w-full text-[10px] py-1 px-2 rounded border-slate-200 focus:ring-blue-500",value:s.proceso_id,onChange:t=>{const n=a.items.map(i=>i.item_id===s.item_id?{...i,proceso_id:t.target.value}:i);l("items",n)},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),s.procesos_compatibles.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[9px] font-black uppercase text-slate-400 mb-1",children:"Papel / Soporte"}),e.jsxs("select",{className:"w-full text-[10px] py-1 px-2 rounded border-slate-200 focus:ring-blue-500",value:s.material_id,onChange:t=>{const n=a.items.map(i=>i.item_id===s.item_id?{...i,material_id:t.target.value}:i);l("items",n)},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),s.papeles_compatibles.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),s.capacidad_por_pliego>0&&e.jsxs("div",{className:"col-span-2 flex items-center justify-between mt-1 px-1",children:[e.jsxs("div",{className:"text-[9px] font-bold text-blue-600",children:["Capacidad: ",s.capacidad_por_pliego," pzs/pg"]}),e.jsxs("div",{className:"text-[9px] font-black text-slate-900 bg-white px-2 py-0.5 rounded shadow-sm border border-slate-200",children:["TOTAL PLIEGOS: ",s.pliegos_necesarios]})]})]})]}),e.jsx("td",{className:"py-3",children:e.jsx("input",{type:"number",className:"w-20 mx-auto text-center px-2 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:s.cantidad,onChange:t=>te(s.item_id,t.target.value),min:"0.01",step:"0.01"})}),e.jsxs("td",{className:"py-3 text-right text-slate-600",children:["$",s.precio_unitario]}),e.jsxs("td",{className:"py-3 text-right font-bold text-slate-900",children:["$",(s.cantidad*s.precio_unitario).toFixed(2)]}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>se(s.item_id),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},s.item_id))})]})})]})]}),e.jsxs("div",{className:"bg-slate-900 text-white p-6 rounded-lg shadow-lg h-fit sticky top-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-6 text-blue-400",children:"Resumen de Orden"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Subtotal:"}),e.jsxs("span",{className:"font-bold",children:["$",H.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"ITBMS (7%):"}),e.jsxs("span",{className:"font-bold",children:["$",G.toFixed(2)]})]}),e.jsx("div",{className:"border-t border-slate-700 pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between text-2xl font-black",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-blue-400",children:["$",f.toFixed(2)]})]})})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-slate-700 space-y-4",children:[e.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-500",children:["Gestión de Anticipo (",r,"%)"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-400 uppercase mb-1",children:"Monto Abonado"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-slate-400 font-bold",children:"$"}),e.jsx("input",{type:"number",value:a.monto_abonado,onChange:s=>l("monto_abonado",parseFloat(s.target.value)||0),className:"w-full bg-slate-800 border-slate-700 rounded-lg pl-8 pr-4 py-2 text-white font-black text-xl focus:ring-blue-500 focus:border-blue-500",min:"0",step:"0.01"})]}),a.monto_abonado<f*(r/100)&&f>0&&e.jsxs("p",{className:"text-red-400 text-[10px] font-bold mt-1 animate-pulse",children:["⚠ Se requiere un abono mínimo de $",(f*(r/100)).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-400 uppercase mb-1",children:"Método de Pago"}),e.jsxs("select",{value:a.metodo_pago_inicial,onChange:s=>l("metodo_pago_inicial",s.target.value),className:"w-full bg-slate-800 border-slate-700 rounded-lg px-4 py-2 text-white text-sm focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"Transferencia",children:"Transferencia Bancaria"}),e.jsx("option",{value:"Yappy",children:"Yappy"}),e.jsx("option",{value:"Efectivo",children:"Efectivo"}),e.jsx("option",{value:"Tarjeta",children:"Tarjeta de Crédito/Débito"}),e.jsx("option",{value:"Cheque",children:"Cheque"})]})]}),a.metodo_pago_inicial!=="Efectivo"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("label",{className:"block text-[10px] font-bold text-slate-400 uppercase mb-1",children:"ID Transacción / Ref. de Pago *"}),e.jsx("input",{type:"text",value:a.metodo_pago_referencia,onChange:s=>l("metodo_pago_referencia",s.target.value),placeholder:"Ej: 154826, #Ref, etc.",className:"w-full bg-slate-800 border-slate-700 rounded-lg px-4 py-2 text-white text-sm font-bold focus:ring-blue-500 focus:border-blue-500 placeholder:opacity-30",required:a.metodo_pago_inicial!=="Efectivo"}),S.metodo_pago_referencia&&e.jsx("span",{className:"text-red-400 text-[10px]",children:S.metodo_pago_referencia})]}),e.jsx("div",{className:"bg-blue-900/30 p-3 rounded-lg border border-blue-500/30",children:e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-blue-300 font-bold uppercase",children:"Saldo Pendiente:"}),e.jsxs("span",{className:"text-white font-black",children:["$",Math.max(0,f-a.monto_abonado).toFixed(2)]})]})})]})]}),e.jsxs("button",{type:"submit",disabled:R||a.items.length===0||!a.contacto_id||a.monto_abonado<f*(r/100)&&f>0,className:"w-full bg-blue-600 text-white mt-6 py-4 rounded-xl font-black text-base hover:bg-blue-500 transition disabled:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed flex flex-col items-center justify-center gap-1 shadow-lg shadow-blue-900/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:R?"Procesando...":"Confirmar y Crear Orden"})]}),e.jsx("span",{className:"text-[9px] uppercase tracking-widest opacity-60",children:"Se generará factura automática"})]})]})]})]})]}),V&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden animate-scale-in",children:[e.jsxs("div",{className:"bg-slate-900 p-6 text-white flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-black tracking-tighter italic uppercase",children:"Registrar Nuevo Cliente"}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Crea un contacto sin salir de la orden"})]}),e.jsx("button",{onClick:()=>q(!1),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(ne,{onSuccess:s=>{N([..._,s]),l("contacto_id",s.id),q(!1)},paymentTerms:z})]})})]})}function ne({onSuccess:_,paymentTerms:N}){var k;const{data:d,setData:u,post:w,processing:m,errors:T,reset:M}=$({razon_social:"",tipo_identificacion:"RUC",identificacion:"",digito_verificador:"",requiere_factura_electronica:!1,direccion:"",telefono:"",email:"",es_cliente:!0,payment_term_id:((k=N[0])==null?void 0:k.id)||""}),z=r=>{r.preventDefault(),ie.post("/api/inventario/contactos",d).then(h=>{_(h.data)}).catch(h=>{var y,j;if(console.error("Error al crear cliente:",h),(j=(y=h.response)==null?void 0:y.data)!=null&&j.errors){const E=Object.values(h.response.data.errors).flat().join(`
`);alert(`Errores de validación:
${E}`)}else alert("No se pudo registrar el cliente. Verifique su conexión o si el documento ya existe.")})};return e.jsxs("form",{onSubmit:z,className:"p-8 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2",children:"Nombre o Razón Social *"}),e.jsx("input",{type:"text",value:d.razon_social,onChange:r=>u("razon_social",r.target.value),className:"w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-3 font-bold focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2",children:"Tipo Id."}),e.jsxs("select",{value:d.tipo_identificacion,onChange:r=>u("tipo_identificacion",r.target.value),className:"w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-3 font-bold",children:[e.jsx("option",{value:"RUC",children:"RUC"}),e.jsx("option",{value:"Cedula",children:"Cédula"}),e.jsx("option",{value:"Pasaporte",children:"Pasaporte"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2",children:"Identificación *"}),e.jsx("input",{type:"text",value:d.identificacion,onChange:r=>u("identificacion",r.target.value),className:"w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-3 font-bold focus:ring-blue-500",required:!0})]}),d.tipo_identificacion==="RUC"&&e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2",children:"DV"}),e.jsx("input",{type:"text",value:d.digito_verificador,onChange:r=>u("digito_verificador",r.target.value),className:"w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-3 font-bold text-center",maxLength:"4"})]})]}),e.jsx("div",{className:"col-span-2 bg-blue-50 p-4 rounded-2xl border border-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-black text-blue-900 uppercase italic",children:"Facturación Electrónica"}),e.jsx("p",{className:"text-[10px] font-bold text-blue-600 mt-1 uppercase",children:"Habilitar envío automático de comprobantes"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:d.requiere_factura_electronica,onChange:r=>u("requiere_factura_electronica",r.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2",children:"Teléfono"}),e.jsx("input",{type:"text",value:d.telefono,onChange:r=>u("telefono",r.target.value),className:"w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-3 font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2",children:"Email"}),e.jsx("input",{type:"email",value:d.email,onChange:r=>u("email",r.target.value),className:"w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-3 font-bold"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-2",children:"Dirección"}),e.jsx("textarea",{value:d.direccion,onChange:r=>u("direccion",r.target.value),className:"w-full bg-slate-50 border-slate-200 rounded-xl px-4 py-2 font-bold h-20"})]})]}),e.jsx("div",{className:"flex gap-4 pt-4 border-t border-slate-100",children:e.jsx("button",{type:"submit",disabled:m,className:"flex-1 bg-slate-900 text-white py-4 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-slate-800 transition shadow-xl",children:m?"CREANDO...":"GUARDAR CLIENTE"})})]})}export{xe as default};
