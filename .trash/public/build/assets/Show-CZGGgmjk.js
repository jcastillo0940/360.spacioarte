import{r as l,u as v,j as e,H as w,a as x}from"./app-OZZRvyqe.js";import{A as p}from"./AuthenticatedLayout-D2-JfW7j.js";import{F as k}from"./file-text-RP8-UYCr.js";import{c as r}from"./createLucideIcon-Dvcv2Uye.js";import{S as _}from"./send-Bv8V4sbS.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],S=r("clock",C);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],$=r("copy",q);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],E=r("external-link",z);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],M=r("message-square",D);function V({ordenId:n}){var c,d;const[t,m]=l.useState(null),[h,u]=l.useState(!0),{data:a,setData:o,post:L,processing:b,reset:g}=v({mensaje_texto:"",requiere_aprobacion:!1,archivo:null}),i=()=>{fetch(`/api/ventas/ordenes/${n}`).then(s=>s.json()).then(s=>{m(s),u(!1)})};l.useEffect(()=>{i()},[n]);const f=()=>{confirm("¿Desea generar la factura fiscal a partir de esta orden?")&&x.post(route("facturas.convertir",t.id))},j=s=>{s.preventDefault(),x.post(route("tracking.mensaje",t.tracking_token),{...a,emisor:"staff"},{onSuccess:()=>{g(),i()}})},N=()=>{const s=`${window.location.origin}/tracking/${t.tracking_token}`;navigator.clipboard.writeText(s),alert("Enlace de seguimiento copiado al portapapeles")},y=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return h?e.jsx(p,{children:e.jsxs("div",{className:"max-w-6xl mx-auto p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4",children:"Cargando detalles de producción..."})]})}):e.jsxs(p,{children:[e.jsx(w,{title:`Orden ${t.numero_orden}`}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 bg-slate-50 border-b border-slate-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-slate-900",children:["Orden: ",t.numero_orden]}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Cliente: ",(c=t.cliente)==null?void 0:c.razon_social]})]}),e.jsxs("div",{className:"flex gap-2",children:[t.estado==="Confirmada"&&e.jsxs("button",{onClick:f,className:"px-4 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 flex items-center gap-2",children:[e.jsx(k,{size:18})," Facturar"]}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase ${t.estado_diseno==="Aprobado"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:["Diseño: ",t.estado_diseno]})]})]}),e.jsx("div",{className:"p-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-4 text-left text-xs font-bold uppercase text-slate-600",children:"Descripción"}),e.jsx("th",{className:"pb-4 text-center text-xs font-bold uppercase text-slate-600",children:"Cant."}),e.jsx("th",{className:"pb-4 text-right text-xs font-bold uppercase text-slate-600",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:t.detalles.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-4 text-slate-900",children:s.item.nombre}),e.jsx("td",{className:"py-4 text-center text-slate-600",children:s.cantidad}),e.jsx("td",{className:"py-4 text-right font-bold text-slate-900",children:y(s.total)})]},s.id))})]})})]}),e.jsxs("div",{className:"bg-indigo-50 border border-indigo-100 rounded-xl p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-indigo-900 font-bold flex items-center gap-2",children:[e.jsx(E,{size:18})," Enlace de Seguimiento para Cliente"]}),e.jsx("p",{className:"text-indigo-700 text-sm",children:"Envía este link al cliente para que apruebe el diseño."})]}),e.jsxs("button",{onClick:N,className:"bg-white text-indigo-600 px-4 py-2 rounded-lg border border-indigo-200 font-bold hover:bg-indigo-100 flex items-center gap-2 shadow-sm",children:[e.jsx($,{size:18})," Copiar Link"]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col h-[600px]",children:[e.jsx("div",{className:"p-4 border-b bg-slate-50 rounded-t-xl",children:e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(M,{size:18})," Comunicación con Cliente"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50",children:(d=t.mensajes)==null?void 0:d.map(s=>e.jsx("div",{className:`flex ${s.emisor==="staff"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[90%] p-3 rounded-xl shadow-sm ${s.emisor==="staff"?"bg-blue-600 text-white":"bg-white text-slate-800 border border-slate-200"}`,children:[e.jsx("p",{className:"text-sm",children:s.mensaje_texto}),s.requiere_aprobacion&&e.jsxs("div",{className:"mt-2 py-1 px-2 bg-yellow-400 text-yellow-950 text-[10px] font-black rounded uppercase flex items-center gap-1",children:[e.jsx(S,{size:12})," Pendiente Aprobación"]}),e.jsx("div",{className:"text-[10px] mt-1 opacity-70 text-right italic",children:new Date(s.created_at).toLocaleTimeString()})]})},s.id))}),e.jsxs("form",{onSubmit:j,className:"p-4 border-t space-y-3",children:[e.jsx("textarea",{value:a.mensaje_texto,onChange:s=>o("mensaje_texto",s.target.value),placeholder:"Escribe al cliente o notas de diseño...",className:"w-full border-slate-200 rounded-lg text-sm focus:ring-blue-500 h-20"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs font-bold text-slate-600 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.requiere_aprobacion,onChange:s=>o("requiere_aprobacion",s.target.checked),className:"rounded text-blue-600"}),"¿Requiere Aprobación?"]}),e.jsxs("button",{disabled:b||!a.mensaje_texto,className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 disabled:opacity-50",children:[e.jsx(_,{size:16})," Enviar"]})]})]})]})})]})})]})}export{V as default};
