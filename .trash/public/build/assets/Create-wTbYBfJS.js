import{r,u as A,j as e,H as k}from"./app-OZZRvyqe.js";import{A as _}from"./AuthenticatedLayout-D2-JfW7j.js";function R(){const[y,m]=r.useState([]),[b,p]=r.useState([]),[u,d]=r.useState([]),[S,j]=r.useState([]),[C,x]=r.useState([]),[L,g]=r.useState(!0),[h,f]=r.useState(""),[v,i]=r.useState(!1),{data:a,setData:n,post:M,processing:N,errors:w}=A({contacto_id:"",sucursal_id:"",vendedor_id:"",fecha_emision:new Date().toISOString().split("T")[0],fecha_entrega:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],items:[]}),[z,B]=r.useState(0),[F,I]=r.useState(0),[D,E]=r.useState(0);r.useEffect(()=>{O()},[]);const O=()=>{fetch("/api/ventas/ordenes/datos").then(s=>s.json()).then(s=>{m(s.clientes||[]),p(s.productos||[]),d(s.productos||[]),j(s.vendedores||[]),g(!1)}).catch(s=>{console.error("Error loading data:",s),m([]),p([]),d([]),j([]),g(!1)})},V=s=>{if(!s){x([]),n("sucursal_id","");return}fetch(`/api/inventario/sucursales/contacto/${s}`).then(t=>t.json()).then(t=>{x(t||[]),(t||[]).length>0?n("sucursal_id",t[0].id):n("sucursal_id","")}).catch(t=>{console.error("Error loading sucursales:",t),x([])})},T=s=>{if(f(s),s.length===0)d(b),i(!1);else{const t=b.filter(l=>l.nombre.toLowerCase().includes(s.toLowerCase())||l.codigo.toLowerCase().includes(s.toLowerCase())||l.categoria&&l.categoria.toLowerCase().includes(s.toLowerCase()));d(t),i(!0)}},W=s=>{var l;if(a.items.find(o=>o.item_id===s.id)){const o=a.items.map(c=>c.item_id===s.id?{...c,cantidad:c.cantidad+1}:c);n("items",o)}else{const o={item_id:s.id,nombre:s.nombre,cantidad:1,precio_unitario:s.precio_venta,tasa_itbms:((l=s.tax)==null?void 0:l.tasa)||0};n("items",[...a.items,o])}f(""),i(!1)},$=s=>{n("items",a.items.filter(t=>t.item_id!==s))},P=(s,t)=>{const l=a.items.map(o=>o.item_id===s?{...o,cantidad:parseFloat(t)||0}:o);n("items",l)};r.useEffect(()=>{let s=0,t=0;a.items.forEach(l=>{const o=l.cantidad*l.precio_unitario;s+=o,t+=o*(l.tasa_itbms/100)}),B(s),I(t),E(s+t)},[a.items]);const H=s=>{s.preventDefault(),M(route("ordenes.store"))};return L?e.jsxs(_,{children:[e.jsx(k,{title:"Nueva Orden de Venta"}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4",children:"Cargando datos..."})]})})]}):e.jsxs(_,{children:[e.jsx(k,{title:"Nueva Orden de Venta"}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("h1",{className:"text-3xl font-black text-slate-900 flex items-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Nueva Orden de Venta"]})}),e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Información General"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Cliente *"}),e.jsxs("select",{value:a.contacto_id,onChange:s=>{n("contacto_id",s.target.value),V(s.target.value)},className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",required:!0,children:[e.jsx("option",{value:"",children:"Seleccione un cliente"}),y.map(s=>e.jsx("option",{value:s.id,children:s.razon_social},s.id))]}),w.contacto_id&&e.jsx("span",{className:"text-red-500 text-xs",children:w.contacto_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Sucursal"}),e.jsxs("select",{value:a.sucursal_id,onChange:s=>n("sucursal_id",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",disabled:!a.contacto_id,children:[e.jsx("option",{value:"",children:"Sucursal principal"}),C.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Vendedor"}),e.jsxs("select",{value:a.vendedor_id,onChange:s=>n("vendedor_id",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",children:[e.jsx("option",{value:"",children:"Sin vendedor"}),S.map(s=>e.jsx("option",{value:s.id,children:s.nombre_completo},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Fecha Entrega"}),e.jsx("input",{type:"date",value:a.fecha_entrega,onChange:s=>n("fecha_entrega",s.target.value),className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Buscar Producto"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:h,onChange:s=>T(s.target.value),onFocus:()=>h&&i(!0),placeholder:"Buscar por nombre, código o categoría...",className:"w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition",autoComplete:"off"}),v&&u.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-64 overflow-y-auto",children:u.map(s=>e.jsx("button",{type:"button",onClick:()=>W(s),className:"w-full text-left p-3 hover:bg-blue-50 border-b border-slate-100 last:border-0 transition",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-slate-900",children:s.nombre}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[e.jsx("span",{className:"font-mono",children:s.codigo}),s.categoria&&e.jsxs("span",{className:"ml-2",children:["• ",s.categoria]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:"font-bold text-blue-600",children:["$",s.precio_venta]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Stock: ",s.stock_actual||"N/A"]})]})]})},s.id))}),v&&h&&u.length===0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg p-4 text-center text-slate-500",children:"No se encontraron productos"})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-slate-200",children:[e.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-slate-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),"Items en la Orden (",a.items.length,")"]}),a.items.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),e.jsx("p",{className:"font-bold",children:"No hay productos añadidos"}),e.jsx("p",{className:"text-sm mt-1",children:"Usa el buscador para agregar productos"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b-2 border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"pb-3 text-left text-xs font-bold uppercase text-slate-600",children:"Producto"}),e.jsx("th",{className:"pb-3 text-center text-xs font-bold uppercase text-slate-600",children:"Cant."}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase text-slate-600",children:"Precio"}),e.jsx("th",{className:"pb-3 text-right text-xs font-bold uppercase text-slate-600",children:"Subtotal"}),e.jsx("th",{className:"pb-3"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:a.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-medium text-slate-900",children:s.nombre}),e.jsx("td",{className:"py-3",children:e.jsx("input",{type:"number",className:"w-20 mx-auto text-center px-2 py-2 border border-slate-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500",value:s.cantidad,onChange:t=>P(s.item_id,t.target.value),min:"0.01",step:"0.01"})}),e.jsxs("td",{className:"py-3 text-right text-slate-600",children:["$",s.precio_unitario]}),e.jsxs("td",{className:"py-3 text-right font-bold text-slate-900",children:["$",(s.cantidad*s.precio_unitario).toFixed(2)]}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("button",{type:"button",onClick:()=>$(s.item_id),className:"text-red-500 hover:text-red-700 p-1",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},s.item_id))})]})})]})]}),e.jsxs("div",{className:"bg-slate-900 text-white p-6 rounded-lg shadow-lg h-fit sticky top-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-6 text-blue-400",children:"Resumen de Orden"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"Subtotal:"}),e.jsxs("span",{className:"font-bold",children:["$",z.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"ITBMS (7%):"}),e.jsxs("span",{className:"font-bold",children:["$",F.toFixed(2)]})]}),e.jsx("div",{className:"border-t border-slate-700 pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between text-2xl font-black",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-blue-400",children:["$",D.toFixed(2)]})]})})]}),e.jsxs("button",{type:"submit",disabled:N||a.items.length===0||!a.contacto_id,className:"w-full bg-blue-600 text-white mt-6 py-4 rounded-lg font-bold hover:bg-blue-500 transition disabled:bg-slate-600 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),N?"Procesando...":"Guardar Orden de Venta"]})]})]})]})]})]})}export{R as default};
